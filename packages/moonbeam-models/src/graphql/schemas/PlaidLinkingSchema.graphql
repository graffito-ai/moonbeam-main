# graphql/PlaidLinkingSchema.graphql
# Plaid Linking Schema File
enum PlaidLinkingErrorType {
    DUPLICATE_OBJECT_FOUND
    NONE_OR_ABSENT
    VALIDATION_ERROR
    UNEXPECTED_ERROR
    UNPROCESSABLE
}

enum BankingItemErrorType {
    DUPLICATE_OBJECT_FOUND
    NONE_OR_ABSENT
    VALIDATION_ERROR
    UNEXPECTED_ERROR
    UNPROCESSABLE
}

enum PlaidProducts {
    auth
    transactions
}

enum PlaidCountryCodes {
    US
}

enum PlaidLanguages {
    en
}

enum PlaidLinkingAccountSubtype {
    checking,
    savings,
    hsa,
    cd,
    money market,
    paypal,
    prepaid,
    cash management,
    ebt,
    all,
    credit card
}

enum PlaidLinkingAccountType {
    investment
    credit
    depository
    loan
    other
}

enum PlaidLinkingSessionStatus {
    INITIATED
    ERROR
    EXITED
    SUCCESS
}

enum PlaidWebhookType {
    LINK
}

enum PlaidWebhookCode {
    SESSION_FINISHED
}

enum PlaidWebhookStatus {
    SUCCESS
    EXITED
}

enum PlaidEnvironment {
    sandbox
    development
    production
}

enum BankingItemStatus {
    INITIATED
    LINKED
    PAUSED
    NOT_LINKED
}

enum BankingAccountStatus {
    ACTIVE
    PAUSED
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
type PlaidLinkingSession @aws_cognito_user_pools @aws_api_key {
    id: ID! ## this represents the user ID, passed into the create call through the user.client_user_id parameter
    timestamp: AWSTimestamp! ## this represents the timestamp, in a Number epoch based format (for sorting purposes)
    createdAt: AWSDateTime!
    updatedAt: AWSDateTime!
    hosted_link_url: String!
    link_token: String!
    request_id: String!
    expiration: AWSDateTime!
    status: PlaidLinkingSessionStatus!
    public_token: String,
    session_id: String
}

type PlaidLinkingSessionResponse @aws_cognito_user_pools @aws_api_key {
    data: PlaidLinkingSession
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

type UpdatePlaidLinkingSessionResponse @aws_cognito_user_pools @aws_api_key {
    id: ID ## this represents the userID, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    link_token: String ## this represents the link token, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    timestamp: AWSTimestamp ### this represents the creation timestamp, in a Number epoch based format, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    data: PlaidLinkingSession
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

### this Follows Plaid's https://plaid.com/docs/api/items/#session_finished API schema
type PlaidWebhookLinkInput @aws_cognito_user_pools @aws_api_key {
    webhook_type: PlaidWebhookType!
    webhook_code: PlaidWebhookCode!
    status: PlaidWebhookStatus!
    link_session_id: String!
    link_token: String!
    public_token: String
    environment: PlaidEnvironment!
}

type BankingItemResponse @aws_cognito_user_pools @aws_api_key {
    data: BankingItem
    errorType: BankingItemErrorType
    errorMessage: String
}

type TokenExchangeResponse @aws_cognito_user_pools @aws_api_key {
    data: TokenExchange
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

type PlaidAuthResponse @aws_cognito_user_pools @aws_api_key {
    data: PlaidAuth
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

type InstitutionResponse @aws_cognito_user_pools @aws_api_key {
    data: Institution
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

## this Follows Plaid's https://plaid.com/docs/api/institutions/#institutionsget_by_id API schema
type Institution @aws_cognito_user_pools @aws_api_key {
    name: String!
    institution_id: String!
}

## this Follows Plaid's https://plaid.com/docs/api/products/auth/#authget API schema
type PlaidAuth @aws_cognito_user_pools @aws_api_key {
    item_id: String!
    institution_id: String!
    account: [PlaidAuthAccount!]
}

## this Follows Plaid's https://plaid.com/docs/api/products/auth/#authget API schema
type PlaidAuthAccount @aws_cognito_user_pools @aws_api_key {
    account_id: ID!
    persistent_account_id: ID!
    mask: String!
    name: String!
    official_name: String!
    subtype: PlaidLinkingAccountSubtype!
    type: PlaidLinkingAccountType!
    account: String!
    routing: String!
    wire_routing: String!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#itempublic_tokenexchange API schema
type TokenExchange @aws_cognito_user_pools @aws_api_key {
    access_token: String!
    item_id: String!
    request_id: String!
}

type BankingItem @aws_cognito_user_pools @aws_api_key {
    id: ID! # the userID associated with the Banking Item
    timestamp: AWSTimestamp! # this represents the creation timestamp, in a Number epoch based format, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    createdAt: AWSDateTime!
    updatedAt: AWSDateTime!
    itemId: ID! # the Plaid item_id
    institutionId: String! # the Plaid institution_id
    name: String! # Plaid institution name
    accessToken: String! # the Plaid Access Token for Banking Item
    publicToken: String! # the Plaid Public Token used to be exchanged for an access_token
    linkToken: String! # the Plaid Link Token used to retrieve a Public Token from
    status: BankingItemStatus! # the status of the Banking Item
    accounts: [BankingAccount!] # array of accounts associated with a Banking Item
}

type BankingAccount @aws_cognito_user_pools @aws_api_key {
    id: ID!  # uniquely generated Moonbeam id
    accountId: ID! # the Plaid account_id
    persistentAccountId: String! # the Plaid persistent_account_id
    accountNumber: String! # the account in Plaid ACH numbers array
    routingNumber: String! # the routing in PLaid ACH numbers array
    wireRoutingNumber: String! # the wire_routing in Plaid ACH numbers array
    accountMask: String! # the mask in Plaid's account information
    accountName: String! # the name in Plaid's account information
    accountOfficialName: String! # the official name in the Plaid's account information
    type: PlaidLinkingAccountType!  # the type in Plaid's account information
    subType: PlaidLinkingAccountSubtype! # the sub_type in Plaid's account information
    createdAt: AWSDateTime!
    updatedAt: AWSDateTime!
    status: BankingAccountStatus! # the status of a particular account within a banking Item
}

input BankingAccountInput {
    id: ID  # uniquely generated Moonbeam id
    accountId: ID! # the Plaid account_id
    persistentAccountId: String! # the Plaid persistent_account_id
    accountNumber: String! # the account in Plaid ACH numbers array
    routingNumber: String! # the routing in PLaid ACH numbers array
    wireRoutingNumber: String! # the wire_routing in Plaid ACH numbers array
    accountMask: String! # the mask in Plaid's account information
    accountName: String! # the name in Plaid's account information
    accountOfficialName: String! # the official name in the Plaid's account information
    type: PlaidLinkingAccountType!  # the type in Plaid's account information
    subType: PlaidLinkingAccountSubtype! # the sub_type in Plaid's account information
    createdAt: AWSDateTime
    updatedAt: AWSDateTime
    status: BankingAccountStatus # the status of a particular account within a banking Item
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserNameInput {
    given_name: String!
    family_name: String!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserAddressInput {
    street: String!
    city: String!
    region: String!
    postal_code: String!
    country: String!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingTransactionsInput {
    days_requested: Int!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingHostedLinkInput {
    completion_redirect_uri: String!
    url_lifetime_seconds: Int!
    is_mobile_app: Boolean!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserInput {
    client_user_id: String!
    legal_name: String!
    name: PlaidLinkingUserNameInput!
    phone_number: String!
    email_address: String!
    date_of_birth: String!
    address: PlaidLinkingUserAddressInput!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingAccountFilterInput {
    account_subtypes: [PlaidLinkingAccountSubtype!]
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingAccountFiltersInput {
    depository: PlaidLinkingAccountFilterInput
    credit: PlaidLinkingAccountFilterInput
}

input CreatePlaidLinkingSessionInput {
    client_name: String
    client_id: String
    secret: String
    link_customization_name: String
    user: PlaidLinkingUserInput!
    products: [PlaidProducts]
    transactions: PlaidLinkingTransactionsInput
    country_codes: [PlaidCountryCodes]
    redirect_uri: String
    language: PlaidLanguages
    webhook: String
    hosted_link: PlaidLinkingHostedLinkInput!
    account_filters: PlaidLinkingAccountFiltersInput
    createdAt: AWSDateTime
    updatedAt: AWSDateTime
    status: PlaidLinkingSessionStatus
}

input UpdatePlaidLinkingSessionInput {
    id: ID!
    link_token: String!
    session_id: String!
    status: PlaidLinkingSessionStatus!
    public_token: String!
    updatedAt: AWSDateTime
}

input GetPlaidLinkingSessionByTokenInput {
    link_token: String!
}

input GetBankingItemByTokenInput {
    id: ID!
    linkToken: String!
}

input CreateBankingItemInput {
    id: ID! # the userID associated with the Banking Item
    timestamp: AWSTimestamp # this represents the creation timestamp, in a Number epoch based format, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    createdAt: AWSDateTime
    updatedAt: AWSDateTime
    itemId: ID! # the Plaid item_id
    institutionId: String! # the Plaid institution_id
    name: String! # Plaid institution name
    accessToken: String! # the Plaid Access Token for Banking Item
    publicToken: String! # the Plaid Public Token used to be exchanged for an access_token
    linkToken: String! # the Plaid Link Token used to retrieve a Public Token from
    status: BankingItemStatus # the status of the Banking Item
    accounts: [BankingAccountInput]! # array of accounts associated with a Banking Item
}

input UpdateBankingItemInput {
    id: ID!
    linkToken: String!
    status: BankingItemStatus!
}
