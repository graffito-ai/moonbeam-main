# graphql/PlaidLinkingSchema.graphql
# Plaid Linking Schema File
enum PlaidLinkingErrorType {
    DUPLICATE_OBJECT_FOUND
    NONE_OR_ABSENT
    VALIDATION_ERROR
    UNEXPECTED_ERROR
    UNPROCESSABLE
}

enum PlaidProducts {
    auth
    transactions
}

enum PlaidCountryCodes {
    US
}

enum PlaidLanguages {
    en
}

enum PlaidLinkingAccountSubtype {
    checking,
    savings,
    hsa,
    cd,
    money market,
    paypal,
    prepaid,
    cash management,
    ebt,
    all,
    credit card
}

enum PlaidLinkingSessionStatus {
    INITIATED
    ERROR
    EXIT
    SUCCESS
}

enum PlaidWebhookType {
    LINK
}

enum PlaidWebhookCode {
    SESSION_FINISHED
}

enum PlaidWebhookStatus {
    SUCCESS
    EXITED
}

enum PlaidEnvironment {
    sandbox
    development
    production
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
type PlaidLinkingSession @aws_cognito_user_pools @aws_api_key {
    id: ID! ## this represents the user ID, passed into the create call through the user.client_user_id parameter
    timestamp: AWSTimestamp! ## this represents the timestamp, in a Number epoch based format (for sorting purposes)
    createdAt: AWSDateTime!
    updatedAt: AWSDateTime!
    hosted_link_url: String!
    link_token: String!
    request_id: String!
    expiration: AWSDateTime!
    status: PlaidLinkingSessionStatus!
    public_token: String,
    session_id: String
}

type PlaidLinkingSessionResponse @aws_cognito_user_pools @aws_api_key {
    data: PlaidLinkingSession
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

type UpdatePlaidLinkingSessionResponse @aws_cognito_user_pools @aws_api_key {
    id: ID ## this represents the userID, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    link_token: String ## this represents the link token, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    timestamp: AWSTimestamp ### this represents the creation timestamp, in a Number epoch based format, and the reason we repeat it in the parent response is for the subscription filtering to work properly
    data: PlaidLinkingSession
    errorType: PlaidLinkingErrorType
    errorMessage: String
}

### this Follows Plaid's https://plaid.com/docs/api/items/#session_finished API schema
type PlaidWebhookLinkInput @aws_cognito_user_pools @aws_api_key {
    webhook_type: PlaidWebhookType!
    webhook_code: PlaidWebhookCode!
    status: PlaidWebhookStatus!
    link_session_id: String!
    link_token: String!
    public_token: String
    environment: PlaidEnvironment!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserNameInput {
    given_name: String!
    family_name: String!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserAddressInput {
    street: String!
    city: String!
    region: String!
    postal_code: String!
    country: String!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingTransactionsInput {
    days_requested: Int!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingHostedLinkInput {
    completion_redirect_uri: String!
    url_lifetime_seconds: Int!
    is_mobile_app: Boolean!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingUserInput {
    client_user_id: String!
    legal_name: String!
    name: PlaidLinkingUserNameInput!
    phone_number: String!
    email_address: String!
    date_of_birth: String!
    address: PlaidLinkingUserAddressInput!
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingAccountFilterInput {
    account_subtypes: [PlaidLinkingAccountSubtype!]
}

## this Follows Plaid's https://plaid.com/docs/api/tokens/#linktokencreate API schema
input PlaidLinkingAccountFiltersInput {
    depository: PlaidLinkingAccountFilterInput
    credit: PlaidLinkingAccountFilterInput
}

input CreatePlaidLinkingSessionInput {
    client_name: String
    client_id: String
    secret: String
    link_customization_name: String
    user: PlaidLinkingUserInput!
    products: [PlaidProducts]
    transactions: PlaidLinkingTransactionsInput
    country_codes: [PlaidCountryCodes]
    redirect_uri: String
    language: PlaidLanguages
    webhook: String
    hosted_link: PlaidLinkingHostedLinkInput!
    account_filters: PlaidLinkingAccountFiltersInput
    createdAt: AWSDateTime
    updatedAt: AWSDateTime
    status: PlaidLinkingSessionStatus
}

input UpdatePlaidLinkingSessionInput {
    id: ID!
    link_token: String!
    session_id: String!
    status: PlaidLinkingSessionStatus!
    public_token: String!
    updatedAt: AWSDateTime
}

input GetPlaidLinkingSessionByTokenInput {
    link_token: String!
}
