"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseAPIClient = void 0;
const client_secrets_manager_1 = require("@aws-sdk/client-secrets-manager");
const Constants_1 = require("../Constants");
const GraphqlExports_1 = require("../GraphqlExports");
/**
 * Class used as the base/generic client for all API clients that
 * we will be connecting to.
 */
class BaseAPIClient {
    // The Secrets Manager client, to be used while retrieving secrets related to clients.
    secretsClient;
    // The AWS region that the API client will be initialized in
    region;
    // The AWS environment that the API client will be initialized in
    environment;
    /**
     * Generic constructor for the API client.
     *
     * @param region the AWS region passed in from the Lambda resolver.
     * @param environment the AWS environment passed in from the Lambda resolver.
     */
    constructor(region, environment) {
        this.region = region;
        this.environment = environment;
        this.secretsClient = new client_secrets_manager_1.SecretsManagerClient({ region: region });
    }
    /**
     * Function used to retrieve various service credentials, used by any API clients, through the
     * Secrets Manager client.
     *
     * @param verificationClientSecretsName the name of the API client's secrets pair
     * @param internalRestBased optional flag indicating whether the key is REST or GraphQL/AppSync based
     *                          in case of internal-used based keys
     * @param notificationType  optional type indicating the type of notification, for which we are retrieving
     *                          specific secret configuration for
     * @param includeLoyaltyPrograms optional type indicating whether to include the loyalty program secret keys,
     *                               used for Olive calls
     * @param cognitoClientAccess optional type indicating whether to include the cognito access credentials/keys,
     *                            used for internal-based calls
     * @param channelType optional type indicating the type of channel, for which we are retrieving specific secret
     *                    configuration for
     *
     * @return a {@link Promise} of a {@link string} pair, containing various secrets to be used
     */
    async retrieveServiceCredentials(verificationClientSecretsName, internalRestBased, notificationType, includeLoyaltyPrograms, cognitoClientAccess, channelType) {
        try {
            // retrieve the secrets pair for the API client, depending on the current environment and region
            const verificationClientAPIPair = await this.secretsClient
                .send(new client_secrets_manager_1.GetSecretValueCommand(({ SecretId: `${verificationClientSecretsName}-${this.environment}-${this.region}` })));
            // check if the secrets for the API Client exist
            if (verificationClientAPIPair.SecretString) {
                // convert the retrieved secrets pair value, as a JSON object
                const clientPairAsJson = JSON.parse(verificationClientAPIPair.SecretString);
                // filter out and set the necessary API Client API credentials, depending on the client secret name passed in
                switch (verificationClientSecretsName) {
                    case Constants_1.Constants.AWSPairConstants.MOONBEAM_INTERNAL_SECRET_NAME:
                        if (cognitoClientAccess !== undefined && cognitoClientAccess) {
                            return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.CONGITO_CLI_ACCESS_KEY_ID], clientPairAsJson[Constants_1.Constants.AWSPairConstants.COGNITO_CLI_SECRET_ACCESS_KEY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.COGNITO_USER_POOL_ID]];
                        }
                        else {
                            return internalRestBased !== undefined && internalRestBased
                                ? [clientPairAsJson[Constants_1.Constants.AWSPairConstants.MOONBEAM_INTERNAL_REST_BASE_URL], clientPairAsJson[Constants_1.Constants.AWSPairConstants.MOONBEAM_INTERNAL_REST_API_KEY]]
                                : [clientPairAsJson[Constants_1.Constants.AWSPairConstants.MOONBEAM_INTERNAL_BASE_URL], clientPairAsJson[Constants_1.Constants.AWSPairConstants.MOONBEAM_INTERNAL_API_KEY]];
                        }
                    case Constants_1.Constants.AWSPairConstants.COURIER_INTERNAL_SECRET_NAME:
                        // return the appropriate secrets, depending on the type of notification passed in
                        if (!notificationType) {
                            console.log(`Invalid notification type to retrieve secrets in ${verificationClientSecretsName}`);
                            return [null, null];
                        }
                        else {
                            switch (notificationType) {
                                case GraphqlExports_1.NotificationType.NewUserSignup:
                                    return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                        clientPairAsJson[Constants_1.Constants.AWSPairConstants.NEW_USER_SIGNUP_NOTIFICATION_AUTH_TOKEN],
                                        clientPairAsJson[Constants_1.Constants.AWSPairConstants.NEW_USER_SIGNUP_NOTIFICATION_TEMPLATE_ID]];
                                case GraphqlExports_1.NotificationType.NewQualifyingOfferAvailable:
                                    return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                        clientPairAsJson[Constants_1.Constants.AWSPairConstants.NEW_QUALIFYING_OFFER_NOTIFICATION_AUTH_TOKEN],
                                        clientPairAsJson[Constants_1.Constants.AWSPairConstants.NEW_QUALIFYING_OFFER_NOTIFICATION_TEMPLATE_ID]];
                                case GraphqlExports_1.NotificationType.MilitaryStatusChangedPendingToRejected:
                                    if (channelType !== undefined) {
                                        return channelType === GraphqlExports_1.NotificationChannelType.Email
                                            ? [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_REJECTED_AUTH_TOKEN],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_REJECTED_TEMPLATE_ID]]
                                            : [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.PUSH_STATUS_CHANGED_PENDING_TO_REJECTED_AUTH_TOKEN],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.PUSH_STATUS_CHANGED_PENDING_TO_REJECTED_TEMPLATE_ID]];
                                    }
                                    else {
                                        return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                            clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_REJECTED_AUTH_TOKEN],
                                            clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_REJECTED_TEMPLATE_ID]];
                                    }
                                case GraphqlExports_1.NotificationType.MilitaryStatusChangedPendingToVerified:
                                    if (channelType !== undefined) {
                                        return channelType === GraphqlExports_1.NotificationChannelType.Email
                                            ? [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_VERIFIED_AUTH_TOKEN],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_VERIFIED_TEMPLATE_ID]]
                                            : [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.PUSH_STATUS_CHANGED_PENDING_TO_VERIFIED_AUTH_TOKEN],
                                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.PUSH_STATUS_CHANGED_PENDING_TO_VERIFIED_TEMPLATE_ID]];
                                    }
                                    else {
                                        return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.COURIER_BASE_URL],
                                            clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_VERIFIED_AUTH_TOKEN],
                                            clientPairAsJson[Constants_1.Constants.AWSPairConstants.EMAIL_STATUS_CHANGED_PENDING_TO_VERIFIED_TEMPLATE_ID]];
                                    }
                                default:
                                    console.log(`Unknown notifications type to retrieve secrets in ${verificationClientSecretsName}`);
                                    return [null, null];
                            }
                        }
                    case Constants_1.Constants.AWSPairConstants.QUANDIS_SECRET_NAME:
                        return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.QUANDIS_BASE_URL], clientPairAsJson[Constants_1.Constants.AWSPairConstants.QUANDIS_API_KEY]];
                    case Constants_1.Constants.AWSPairConstants.LIGHTHOUSE_SECRET_NAME:
                        return [clientPairAsJson[Constants_1.Constants.AWSPairConstants.LIGHTHOUSE_BASE_URL], clientPairAsJson[Constants_1.Constants.AWSPairConstants.LIGHTHOUSE_API_KEY]];
                    case Constants_1.Constants.AWSPairConstants.OLIVE_SECRET_NAME:
                        return includeLoyaltyPrograms !== undefined
                            ? [
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_BASE_URL],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_PUBLIC_KEY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_PRIVATE_KEY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_MOONBEAM_DEFAULT_LOYALTY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_MOONBEAM_FIDELIS_DEFAULT_LOYALTY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_MOONBEAM_ONLINE_LOYALTY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_MOONBEAM_PREMIER_ONLINE_LOYALTY],
                                clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_MOONBEAM_PREMIER_NEARBY_LOYALTY],
                            ]
                            : [clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_BASE_URL], clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_PUBLIC_KEY], clientPairAsJson[Constants_1.Constants.AWSPairConstants.OLIVE_PRIVATE_KEY]];
                    default:
                        console.log(`Unknown API client secrets name passed in ${verificationClientSecretsName}`);
                        return [null, null];
                }
            }
            else {
                console.log(`API client secrets pair not available for ${verificationClientSecretsName}, ${verificationClientAPIPair}`);
                return [null, null];
            }
        }
        catch (err) {
            const errorMessage = `Unexpected error while retrieving an API Key ${err}`;
            console.log(errorMessage);
            throw new Error(errorMessage);
        }
    }
}
exports.BaseAPIClient = BaseAPIClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQmFzZUFQSUNsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vY2xpZW50cy9CYXNlQVBJQ2xpZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDRFQUE0RjtBQUU1Riw0Q0FBdUM7QUFDdkMsc0RBMkMyQjtBQUUzQjs7O0dBR0c7QUFDSCxNQUFzQixhQUFhO0lBQy9CLHNGQUFzRjtJQUNuRSxhQUFhLENBQXVCO0lBRXZELDREQUE0RDtJQUN6QyxNQUFNLENBQVM7SUFFbEMsaUVBQWlFO0lBQzlDLFdBQVcsQ0FBUztJQUV2Qzs7Ozs7T0FLRztJQUNILFlBQXNCLE1BQWMsRUFBRSxXQUFtQjtRQUNyRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUUvQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksNkNBQW9CLENBQUMsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7O09BaUJHO0lBQ08sS0FBSyxDQUFDLDBCQUEwQixDQUFDLDZCQUFxQyxFQUFFLGlCQUEyQixFQUNsRSxnQkFBbUMsRUFBRSxzQkFBZ0MsRUFDckUsbUJBQTZCLEVBQUUsV0FBcUM7UUFFM0csSUFBSTtZQUNBLGdHQUFnRztZQUNoRyxNQUFNLHlCQUF5QixHQUFHLE1BQU0sSUFBSSxDQUFDLGFBQWE7aUJBQ3JELElBQUksQ0FBQyxJQUFJLDhDQUFxQixDQUFDLENBQUMsRUFBQyxRQUFRLEVBQUUsR0FBRyw2QkFBNkIsSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTFILGdEQUFnRDtZQUNoRCxJQUFJLHlCQUF5QixDQUFDLFlBQVksRUFBRTtnQkFDeEMsNkRBQTZEO2dCQUM3RCxNQUFNLGdCQUFn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QUFDLGdCQUFnQixDQUFDLHFDQUFxQyxDQUFDOzZCQUNyRjs0QkFDRCxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxxQkFBUyxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLHFCQUFTLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxxQkFBUyxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztvQkFDdk07d0JBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyw2Q0FBNkMsNkJBQTZCLEVBQUUsQ0FBQyxDQUFDO3dCQUMxRixPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO2lCQUMzQjthQUNKO2lCQUFNO2dCQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTZDLDZCQUE2QixLQUFLLHlCQUF5QixFQUFFLENBQUMsQ0FBQztnQkFFeEgsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQzthQUN2QjtTQUNKO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDVixNQUFNLFlBQVksR0FBRyxnREFBZ0QsR0FBRyxFQUFFLENBQUM7WUFDM0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUUxQixNQUFNLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ2pDO0lBQ0wsQ0FBQztDQWlaSjtBQW5pQkQsc0NBbWlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7R2V0U2VjcmV0VmFsdWVDb21tYW5kLCBTZWNyZXRzTWFuYWdlckNsaWVudH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1zZWNyZXRzLW1hbmFnZXJcIjtcbmltcG9ydCB7QVBJR2F0ZXdheVByb3h5UmVzdWx0fSBmcm9tIFwiYXdzLWxhbWJkYS90cmlnZ2VyL2FwaS1nYXRld2F5LXByb3h5XCI7XG5pbXBvcnQge0NvbnN0YW50c30gZnJvbSBcIi4uL0NvbnN0YW50c1wiO1xuaW1wb3J0IHtcbiAgICBDYXJkLFxuICAgIENhcmRMaW5rUmVzcG9uc2UsXG4gICAgQ3JlYXRlTm90aWZpY2F0aW9uSW5wdXQsXG4gICAgQ3JlYXRlTm90aWZpY2F0aW9uUmVzcG9uc2UsXG4gICAgQ3JlYXRlUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5SW5wdXQsXG4gICAgQ3JlYXRlUmVpbWJ1cnNlbWVudElucHV0LFxuICAgIEVsaWdpYmxlTGlua2VkVXNlcixcbiAgICBFbGlnaWJsZUxpbmtlZFVzZXJzUmVzcG9uc2UsXG4gICAgRW1haWxGcm9tQ29nbml0b1Jlc3BvbnNlLFxuICAgIEdldERldmljZXNGb3JVc2VySW5wdXQsXG4gICAgR2V0T2ZmZXJzSW5wdXQsXG4gICAgR2V0UmVpbWJ1cnNlbWVudEJ5U3RhdHVzSW5wdXQsXG4gICAgR2V0VHJhbnNhY3Rpb25CeVN0YXR1c0lucHV0LFxuICAgIEdldFRyYW5zYWN0aW9uSW5wdXQsXG4gICAgTWVtYmVyRGV0YWlsc1Jlc3BvbnNlLFxuICAgIE1lbWJlclJlc3BvbnNlLFxuICAgIE1pbGl0YXJ5VmVyaWZpY2F0aW9uTm90aWZpY2F0aW9uVXBkYXRlLFxuICAgIE1pbGl0YXJ5VmVyaWZpY2F0aW9uU3RhdHVzVHlwZSxcbiAgICBNb29uYmVhbVRyYW5zYWN0aW9uLFxuICAgIE1vb25iZWFtVHJhbnNhY3Rpb25SZXNwb25zZSxcbiAgICBNb29uYmVhbVRyYW5zYWN0aW9uc0J5U3RhdHVzUmVzcG9uc2UsXG4gICAgTW9vbmJlYW1UcmFuc2FjdGlvbnNSZXNwb25zZSxcbiAgICBNb29uYmVhbVVwZGF0ZWRUcmFuc2FjdGlvblJlc3BvbnNlLFxuICAgIE5vdGlmaWNhdGlvbkNoYW5uZWxUeXBlLFxuICAgIE5vdGlmaWNhdGlvblJlc3BvbnNlLFxuICAgIE5vdGlmaWNhdGlvblR5cGUsXG4gICAgT2ZmZXJzUmVzcG9uc2UsXG4gICAgUmVpbWJ1cnNlbWVudEJ5U3RhdHVzUmVzcG9uc2UsXG4gICAgUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5UmVzcG9uc2UsXG4gICAgUmVpbWJ1cnNlbWVudFJlc3BvbnNlLFxuICAgIFJlbW92ZUNhcmRSZXNwb25zZSxcbiAgICBTZW5kRW1haWxOb3RpZmljYXRpb25JbnB1dCxcbiAgICBTZW5kTW9iaWxlUHVzaE5vdGlmaWNhdGlvbklucHV0LFxuICAgIFRyYW5zYWN0aW9uLFxuICAgIFRyYW5zYWN0aW9uUmVzcG9uc2UsXG4gICAgVHJhbnNhY3Rpb25TdGF0dXNEZXRhaWxzUmVzcG9uc2UsXG4gICAgVXBkYXRlZFRyYW5zYWN0aW9uRXZlbnQsXG4gICAgVXBkYXRlZFRyYW5zYWN0aW9uRXZlbnRSZXNwb25zZSxcbiAgICBVcGRhdGVSZWltYnVyc2VtZW50RWxpZ2liaWxpdHlJbnB1dCxcbiAgICBVcGRhdGVSZWltYnVyc2VtZW50SW5wdXQsXG4gICAgVXBkYXRlVHJhbnNhY3Rpb25JbnB1dCxcbiAgICBVc2VyRGV2aWNlc1Jlc3BvbnNlXG59IGZyb20gXCIuLi9HcmFwaHFsRXhwb3J0c1wiO1xuXG4vKipcbiAqIENsYXNzIHVzZWQgYXMgdGhlIGJhc2UvZ2VuZXJpYyBjbGllbnQgZm9yIGFsbCBBUEkgY2xpZW50cyB0aGF0XG4gKiB3ZSB3aWxsIGJlIGNvbm5lY3RpbmcgdG8uXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlQVBJQ2xpZW50IHtcbiAgICAvLyBUaGUgU2VjcmV0cyBNYW5hZ2VyIGNsaWVudCwgdG8gYmUgdXNlZCB3aGlsZSByZXRyaWV2aW5nIHNlY3JldHMgcmVsYXRlZCB0byBjbGllbnRzLlxuICAgIHByb3RlY3RlZCByZWFkb25seSBzZWNyZXRzQ2xpZW50OiBTZWNyZXRzTWFuYWdlckNsaWVudDtcblxuICAgIC8vIFRoZSBBV1MgcmVnaW9uIHRoYXQgdGhlIEFQSSBjbGllbnQgd2lsbCBiZSBpbml0aWFsaXplZCBpblxuICAgIHByb3RlY3RlZCByZWFkb25seSByZWdpb246IHN0cmluZztcblxuICAgIC8vIFRoZSBBV1MgZW52aXJvbm1lbnQgdGhhdCB0aGUgQVBJIGNsaWVudCB3aWxsIGJlIGluaXRpYWxpemVkIGluXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGVudmlyb25tZW50OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmljIGNvbnN0cnVjdG9yIGZvciB0aGUgQVBJIGNsaWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSByZWdpb24gdGhlIEFXUyByZWdpb24gcGFzc2VkIGluIGZyb20gdGhlIExhbWJkYSByZXNvbHZlci5cbiAgICAgKiBAcGFyYW0gZW52aXJvbm1lbnQgdGhlIEFXUyBlbnZpcm9ubWVudCBwYXNzZWQgaW4gZnJvbSB0aGUgTGFtYmRhIHJlc29sdmVyLlxuICAgICAqL1xuICAgIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihyZWdpb246IHN0cmluZywgZW52aXJvbm1lbnQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnJlZ2lvbiA9IHJlZ2lvbjtcbiAgICAgICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50O1xuXG4gICAgICAgIHRoaXMuc2VjcmV0c0NsaWVudCA9IG5ldyBTZWNyZXRzTWFuYWdlckNsaWVudCh7cmVnaW9uOiByZWdpb259KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIHJldHJpZXZlIHZhcmlvdXMgc2VydmljZSBjcmVkZW50aWFscywgdXNlZCBieSBhbnkgQVBJIGNsaWVudHMsIHRocm91Z2ggdGhlXG4gICAgICogU2VjcmV0cyBNYW5hZ2VyIGNsaWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2ZXJpZmljYXRpb25DbGllbnRTZWNyZXRzTmFtZSB0aGUgbmFtZSBvZiB0aGUgQVBJIGNsaWVudCdzIHNlY3JldHMgcGFpclxuICAgICAqIEBwYXJhbSBpbnRlcm5hbFJlc3RCYXNlZCBvcHRpb25hbCBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0aGUga2V5IGlzIFJFU1Qgb3IgR3JhcGhRTC9BcHBTeW5jIGJhc2VkXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIGluIGNhc2Ugb2YgaW50ZXJuYWwtdXNlZCBiYXNlZCBrZXlzXG4gICAgICogQHBhcmFtIG5vdGlmaWNhdGlvblR5cGUgIG9wdGlvbmFsIHR5cGUgaW5kaWNhdGluZyB0aGUgdHlwZSBvZiBub3RpZmljYXRpb24sIGZvciB3aGljaCB3ZSBhcmUgcmV0cmlldmluZ1xuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZpYyBzZWNyZXQgY29uZmlndXJhdGlvbiBmb3JcbiAgICAgKiBAcGFyYW0gaW5jbHVkZUxveWFsdHlQcm9ncmFtcyBvcHRpb25hbCB0eXBlIGluZGljYXRpbmcgd2hldGhlciB0byBpbmNsdWRlIHRoZSBsb3lhbHR5IHByb2dyYW0gc2VjcmV0IGtleXMsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCBmb3IgT2xpdmUgY2FsbHNcbiAgICAgKiBAcGFyYW0gY29nbml0b0NsaWVudEFjY2VzcyBvcHRpb25hbCB0eXBlIGluZGljYXRpbmcgd2hldGhlciB0byBpbmNsdWRlIHRoZSBjb2duaXRvIGFjY2VzcyBjcmVkZW50aWFscy9rZXlzLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZWQgZm9yIGludGVybmFsLWJhc2VkIGNhbGxzXG4gICAgICogQHBhcmFtIGNoYW5uZWxUeXBlIG9wdGlvbmFsIHR5cGUgaW5kaWNhdGluZyB0aGUgdHlwZSBvZiBjaGFubmVsLCBmb3Igd2hpY2ggd2UgYXJlIHJldHJpZXZpbmcgc3BlY2lmaWMgc2VjcmV0XG4gICAgICogICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gZm9yXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIGEge0BsaW5rIHN0cmluZ30gcGFpciwgY29udGFpbmluZyB2YXJpb3VzIHNlY3JldHMgdG8gYmUgdXNlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhc3luYyByZXRyaWV2ZVNlcnZpY2VDcmVkZW50aWFscyh2ZXJpZmljYXRpb25DbGllbnRTZWNyZXRzTmFtZTogc3RyaW5nLCBpbnRlcm5hbFJlc3RCYXNlZD86IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblR5cGU/OiBOb3RpZmljYXRpb25UeXBlLCBpbmNsdWRlTG95YWx0eVByb2dyYW1zPzogYm9vbGVhbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29nbml0b0NsaWVudEFjY2Vzcz86IGJvb2xlYW4sIGNoYW5uZWxUeXBlPzogTm90aWZpY2F0aW9uQ2hhbm5lbFR5cGUpXG4gICAgICAgIDogUHJvbWlzZTxbc3RyaW5nIHwgbnVsbCwgc3RyaW5nIHwgbnVsbCwgKHN0cmluZyB8IG51bGwpPywgKHN0cmluZyB8IG51bGwpPywgKHN0cmluZyB8IG51bGwpPywgKHN0cmluZyB8IG51bGwpPywgKHN0cmluZyB8IG51bGwpPywgKHN0cmluZyB8IG51bGwpP10+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIHJldHJpZXZlIHRoZSBzZWNyZXRzIHBhaXIgZm9yIHRoZSBBUEkgY2xpZW50LCBkZXBlbmRpbmcgb24gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgYW5kIHJlZ2lvblxuICAgICAgICAgICAgY29uc3QgdmVyaWZpY2F0aW9uQ2xpZW50QVBJUGFpciA9IGF3YWl0IHRoaXMuc2VjcmV0c0NsaWVudFxuICAgICAgICAgICAgICAgIC5zZW5kKG5ldyBHZXRTZWNyZXRWYWx1ZUNvbW1hbmQoKHtTZWNyZXRJZDogYCR7dmVyaWZpY2F0aW9uQ2xpZW50U2VjcmV0c05hbWV9LSR7dGhpcy5lbnZpcm9ubWVudH0tJHt0aGlzLnJlZ2lvbn1gfSkpKTtcblxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHNlY3JldHMgZm9yIHRoZSBBUEkgQ2xpZW50IGV4aXN0XG4gICAgICAgICAgICBpZiAodmVyaWZpY2F0aW9uQ2xpZW50QVBJUGFpci5TZWNyZXRTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAvLyBjb252ZXJ0IHRoZSByZXRyaWV2ZWQgc2VjcmV0cyBwYWlyIHZhbHVlLCBhcyBhIEpTT04gb2JqZWN0XG4gICAgICAgICAgICAgICAgY29uc3QgY2xpZW50UGFpckFzSnNvbiA9IEpTT04ucGFyc2UodmVyaWZpY2F0aW9uQ2xpZW50QVBJUGFpci5TZWNyZXRTdHJpbmchKTtcblxuICAgICAgICAgICAgICAgIC8vIGZpbHRlciBvdXQgYW5kIHNldCB0aGUgbmVjZXNzYXJ5IEFQSSBDbGllbnQgQVBJIGNyZWRlbnRpYWxzLCBkZXBlbmRpbmcgb24gdGhlIGNsaWVudCBzZWNyZXQgbmFtZSBwYXNzZWQgaW5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHZlcmlmaWNhdGlvbkNsaWVudFNlY3JldHNOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuTU9PTkJFQU1fSU5URVJOQUxfU0VDUkVUX05BTUU6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29nbml0b0NsaWVudEFjY2VzcyAhPT0gdW5kZWZpbmVkICYmIGNvZ25pdG9DbGllbnRBY2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2NsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuQ09OR0lUT19DTElfQUNDRVNTX0tFWV9JRF0sIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuQ09HTklUT19DTElfU0VDUkVUX0FDQ0VTU19LRVldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkNPR05JVE9fVVNFUl9QT09MX0lEXV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGVybmFsUmVzdEJhc2VkICE9PSB1bmRlZmluZWQgJiYgaW50ZXJuYWxSZXN0QmFzZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBbY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5NT09OQkVBTV9JTlRFUk5BTF9SRVNUX0JBU0VfVVJMXSwgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5NT09OQkVBTV9JTlRFUk5BTF9SRVNUX0FQSV9LRVldXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFtjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLk1PT05CRUFNX0lOVEVSTkFMX0JBU0VfVVJMXSwgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5NT09OQkVBTV9JTlRFUk5BTF9BUElfS0VZXV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuQ09VUklFUl9JTlRFUk5BTF9TRUNSRVRfTkFNRTpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgYXBwcm9wcmlhdGUgc2VjcmV0cywgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIG5vdGlmaWNhdGlvbiBwYXNzZWQgaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbm90aWZpY2F0aW9uVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBJbnZhbGlkIG5vdGlmaWNhdGlvbiB0eXBlIHRvIHJldHJpZXZlIHNlY3JldHMgaW4gJHt2ZXJpZmljYXRpb25DbGllbnRTZWNyZXRzTmFtZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW251bGwsIG51bGxdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG5vdGlmaWNhdGlvblR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBOb3RpZmljYXRpb25UeXBlLk5ld1VzZXJTaWdudXA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2NsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuQ09VUklFUl9CQVNFX1VSTF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5ORVdfVVNFUl9TSUdOVVBfTk9USUZJQ0FUSU9OX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuTkVXX1VTRVJfU0lHTlVQX05PVElGSUNBVElPTl9URU1QTEFURV9JRF1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE5vdGlmaWNhdGlvblR5cGUuTmV3UXVhbGlmeWluZ09mZmVyQXZhaWxhYmxlOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkNPVVJJRVJfQkFTRV9VUkxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuTkVXX1FVQUxJRllJTkdfT0ZGRVJfTk9USUZJQ0FUSU9OX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuTkVXX1FVQUxJRllJTkdfT0ZGRVJfTk9USUZJQ0FUSU9OX1RFTVBMQVRFX0lEXV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTm90aWZpY2F0aW9uVHlwZS5NaWxpdGFyeVN0YXR1c0NoYW5nZWRQZW5kaW5nVG9SZWplY3RlZDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGFubmVsVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWxUeXBlID09PSBOb3RpZmljYXRpb25DaGFubmVsVHlwZS5FbWFpbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFtjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkNPVVJJRVJfQkFTRV9VUkxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5FTUFJTF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1JFSkVDVEVEX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5FTUFJTF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1JFSkVDVEVEX1RFTVBMQVRFX0lEXV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5DT1VSSUVSX0JBU0VfVVJMXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuUFVTSF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1JFSkVDVEVEX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5QVVNIX1NUQVRVU19DSEFOR0VEX1BFTkRJTkdfVE9fUkVKRUNURURfVEVNUExBVEVfSURdXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2NsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuQ09VUklFUl9CQVNFX1VSTF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuRU1BSUxfU1RBVFVTX0NIQU5HRURfUEVORElOR19UT19SRUpFQ1RFRF9BVVRIX1RPS0VOXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5FTUFJTF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1JFSkVDVEVEX1RFTVBMQVRFX0lEXV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTm90aWZpY2F0aW9uVHlwZS5NaWxpdGFyeVN0YXR1c0NoYW5nZWRQZW5kaW5nVG9WZXJpZmllZDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGFubmVsVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWxUeXBlID09PSBOb3RpZmljYXRpb25DaGFubmVsVHlwZS5FbWFpbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFtjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkNPVVJJRVJfQkFTRV9VUkxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5FTUFJTF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1ZFUklGSUVEX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5FTUFJTF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1ZFUklGSUVEX1RFTVBMQVRFX0lEXV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5DT1VSSUVSX0JBU0VfVVJMXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuUFVTSF9TVEFUVVNfQ0hBTkdFRF9QRU5ESU5HX1RPX1ZFUklGSUVEX0FVVEhfVE9LRU5dLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5QVVNIX1NUQVRVU19DSEFOR0VEX1BFTkRJTkdfVE9fVkVSSUZJRURfVEVNUExBVEVfSURdXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkNPVVJJRVJfQkFTRV9VUkxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLkVNQUlMX1NUQVRVU19DSEFOR0VEX1BFTkRJTkdfVE9fVkVSSUZJRURfQVVUSF9UT0tFTl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuRU1BSUxfU1RBVFVTX0NIQU5HRURfUEVORElOR19UT19WRVJJRklFRF9URU1QTEFURV9JRF1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFVua25vd24gbm90aWZpY2F0aW9ucyB0eXBlIHRvIHJldHJpZXZlIHNlY3JldHMgaW4gJHt2ZXJpZmljYXRpb25DbGllbnRTZWNyZXRzTmFtZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbbnVsbCwgbnVsbF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlIENvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLlFVQU5ESVNfU0VDUkVUX05BTUU6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2NsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuUVVBTkRJU19CQVNFX1VSTF0sIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuUVVBTkRJU19BUElfS0VZXV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuTElHSFRIT1VTRV9TRUNSRVRfTkFNRTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5MSUdIVEhPVVNFX0JBU0VfVVJMXSwgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5MSUdIVEhPVVNFX0FQSV9LRVldXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5PTElWRV9TRUNSRVRfTkFNRTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmNsdWRlTG95YWx0eVByb2dyYW1zICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5PTElWRV9CQVNFX1VSTF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuT0xJVkVfUFVCTElDX0tFWV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuT0xJVkVfUFJJVkFURV9LRVldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLk9MSVZFX01PT05CRUFNX0RFRkFVTFRfTE9ZQUxUWV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuT0xJVkVfTU9PTkJFQU1fRklERUxJU19ERUZBVUxUX0xPWUFMVFldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRQYWlyQXNKc29uW0NvbnN0YW50cy5BV1NQYWlyQ29uc3RhbnRzLk9MSVZFX01PT05CRUFNX09OTElORV9MT1lBTFRZXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5PTElWRV9NT09OQkVBTV9QUkVNSUVSX09OTElORV9MT1lBTFRZXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5PTElWRV9NT09OQkVBTV9QUkVNSUVSX05FQVJCWV9MT1lBTFRZXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbY2xpZW50UGFpckFzSnNvbltDb25zdGFudHMuQVdTUGFpckNvbnN0YW50cy5PTElWRV9CQVNFX1VSTF0sIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuT0xJVkVfUFVCTElDX0tFWV0sIGNsaWVudFBhaXJBc0pzb25bQ29uc3RhbnRzLkFXU1BhaXJDb25zdGFudHMuT0xJVkVfUFJJVkFURV9LRVldXTtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtub3duIEFQSSBjbGllbnQgc2VjcmV0cyBuYW1lIHBhc3NlZCBpbiAke3ZlcmlmaWNhdGlvbkNsaWVudFNlY3JldHNOYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtudWxsLCBudWxsXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBUEkgY2xpZW50IHNlY3JldHMgcGFpciBub3QgYXZhaWxhYmxlIGZvciAke3ZlcmlmaWNhdGlvbkNsaWVudFNlY3JldHNOYW1lfSwgJHt2ZXJpZmljYXRpb25DbGllbnRBUElQYWlyfWApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtudWxsLCBudWxsXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBgVW5leHBlY3RlZCBlcnJvciB3aGlsZSByZXRyaWV2aW5nIGFuIEFQSSBLZXkgJHtlcnJ9YDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yTWVzc2FnZSk7XG5cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBnZXQgYWxsIHRoZSBvZmZlcnMsIGdpdmVuIGNlcnRhaW4gZmlsdGVycyB0byBiZSBwYXNzZWQgaW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWlsaXRhcnlWZXJpZmljYXRpb25Ob3RpZmljYXRpb25VcGRhdGUgdGhlIG1pbGl0YXJ5IHZlcmlmaWNhdGlvbiBub3RpZmljYXRpb24gdXBkYXRlXG4gICAgICogb2JqZWN0cywgdXNlZCB0byBmaWx0ZXIgdGhyb3VnaCB0aGUgQ29nbml0byB1c2VyIHBvb2wsIGluIG9yZGVyIHRvIG9idGFpbiBhIHVzZXIncyBlbWFpbC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEge0BsaW5rIEVtYWlsRnJvbUNvZ25pdG9SZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZSB1c2VyJ3MgZW1haWwgb2J0YWluZWRcbiAgICAgKiBmcm9tIENvZ25pdG8uXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldEVtYWlsRm9yVXNlcj8obWlsaXRhcnlWZXJpZmljYXRpb25Ob3RpZmljYXRpb25VcGRhdGU6IE1pbGl0YXJ5VmVyaWZpY2F0aW9uTm90aWZpY2F0aW9uVXBkYXRlKTogUHJvbWlzZTxFbWFpbEZyb21Db2duaXRvUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBnZXQgYWxsIHRoZSBvZmZlcnMsIGdpdmVuIGNlcnRhaW4gZmlsdGVycyB0byBiZSBwYXNzZWQgaW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZ2V0T2ZmZXJzSW5wdXQgdGhlIG9mZmVycyBpbnB1dCwgY29udGFpbmluZyB0aGUgZmlsdGVyaW5nIGluZm9ybWF0aW9uXG4gICAgICogdXNlZCB0byByZXRyaWV2ZSBhbGwgdGhlIGFwcGxpY2FibGUvbWF0Y2hpbmcgb2ZmZXJzLlxuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgT2ZmZXJzUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgbWF0Y2hlZCBvZmZlcnMnIGluZm9ybWF0aW9uLlxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRPZmZlcnM/KGdldE9mZmVyc0lucHV0OiBHZXRPZmZlcnNJbnB1dCk6IFByb21pc2U8T2ZmZXJzUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBnZXQgYWxsIHRoZSBwaHlzaWNhbCBkZXZpY2VzIGFzc29jaWF0ZWQgd2l0aCBhIHBhcnRpY3VsYXIgdXNlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBnZXREZXZpY2VzRm9yVXNlcklucHV0IHRoZSBkZXZpY2VzIGZvciB1c2VyIGlucHV0LCBjb250YWluaW5nIHRoZSBmaWx0ZXJpbmcgaW5mb3JtYXRpb25cbiAgICAgKiB1c2VkIHRvIHJldHJpZXZlIGFsbCB0aGUgcGh5c2ljYWwgZGV2aWNlcyBmb3IgYSBwYXJ0aWN1bGFyIHVzZXIuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIHtAbGluayBVc2VyRGV2aWNlc1Jlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIG1hdGNoZWQgcGh5c2ljYWwgZGV2aWNlcycgaW5mb3JtYXRpb24uXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldERldmljZXNGb3JVc2VyPyhnZXREZXZpY2VzRm9yVXNlcklucHV0OiBHZXREZXZpY2VzRm9yVXNlcklucHV0KTogUHJvbWlzZTxVc2VyRGV2aWNlc1Jlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gc2VuZCBhIG1vYmlsZSBwdXNoIG5vdGlmaWNhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZW5kTW9iaWxlUHVzaE5vdGlmaWNhdGlvbklucHV0IHRoZSBub3RpZmljYXRpb24gaW5wdXQgZGV0YWlscyB0byBiZSBwYXNzZWQgaW4sIGluIG9yZGVyIHRvIHNlbmRcbiAgICAgKiBhIG1vYmlsZSBwdXNoIG5vdGlmaWNhdGlvblxuICAgICAqIEBwYXJhbSBub3RpZmljYXRpb25UeXBlIHRoZSB0eXBlIG9mIG5vdGlmaWNhdGlvbiB0byBzZW5kIG1vYmlsZSBwdXNoIG5vdGlmaWNhdGlvbnMgZm9yXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIHtAbGluayBOb3RpZmljYXRpb25SZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZSBDb3VyaWVyIG5vdGlmaWNhdGlvbiByZXNwb25zZVxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBzZW5kTW9iaWxlUHVzaE5vdGlmaWNhdGlvbj8oc2VuZE1vYmlsZVB1c2hOb3RpZmljYXRpb25JbnB1dDogU2VuZE1vYmlsZVB1c2hOb3RpZmljYXRpb25JbnB1dCwgbm90aWZpY2F0aW9uVHlwZTogTm90aWZpY2F0aW9uVHlwZSk6IFByb21pc2U8Tm90aWZpY2F0aW9uUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBzZW5kIGFuIGVtYWlsIG5vdGlmaWNhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZW5kRW1haWxOb3RpZmljYXRpb25JbnB1dCB0aGUgbm90aWZpY2F0aW9uIGlucHV0IGRldGFpbHMgdG8gYmUgcGFzc2VkIGluLCBpbiBvcmRlciB0byBzZW5kXG4gICAgICogYW4gZW1haWwgbm90aWZpY2F0aW9uXG4gICAgICogQHBhcmFtIG5vdGlmaWNhdGlvblR5cGUgdGhlIHR5cGUgb2Ygbm90aWZpY2F0aW9uIHRvIHNlbmQgZW1haWwgbm90aWZpY2F0aW9ucyBmb3JcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEge0BsaW5rIE5vdGlmaWNhdGlvblJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIENvdXJpZXIgbm90aWZpY2F0aW9uIHJlc3BvbnNlXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHNlbmRFbWFpbE5vdGlmaWNhdGlvbj8oc2VuZEVtYWlsTm90aWZpY2F0aW9uSW5wdXQ6IFNlbmRFbWFpbE5vdGlmaWNhdGlvbklucHV0LCBub3RpZmljYXRpb25UeXBlOiBOb3RpZmljYXRpb25UeXBlKTogUHJvbWlzZTxOb3RpZmljYXRpb25SZXNwb25zZT47XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIGNyZWF0ZSBhIG5vdGlmaWNhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjcmVhdGVOb3RpZmljYXRpb25JbnB1dCB0aGUgbm90aWZpY2F0aW9uIGRldGFpbHMgdG8gYmUgcGFzc2VkIGluLCBpbiBvcmRlciB0byBjcmVhdGUgYSBuZXdcbiAgICAgKiBub3RpZmljYXRpb25cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEge0BsaW5rIENyZWF0ZU5vdGlmaWNhdGlvblJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIG5ld2x5IGNyZWF0ZWQgbm90aWZpY2F0aW9uIGRhdGFcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgY3JlYXRlTm90aWZpY2F0aW9uPyhjcmVhdGVOb3RpZmljYXRpb25JbnB1dDogQ3JlYXRlTm90aWZpY2F0aW9uSW5wdXQpOiBQcm9taXNlPENyZWF0ZU5vdGlmaWNhdGlvblJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gY3JlYXRlIGEgcmVpbWJ1cnNlbWVudCBlbGlnaWJpbGl0eS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjcmVhdGVSZWltYnVyc2VtZW50RWxpZ2liaWxpdHlJbnB1dCB0aGUgcmVpbWJ1cnNlbWVudCBlbGlnaWJpbGl0eSBkZXRhaWxzIHRvIGJlIHBhc3NlZCBpbixcbiAgICAgKiBpbiBvcmRlciB0byBjcmVhdGUgYSBuZXcgcmVpbWJ1cnNlbWVudCBlbGlnaWJpbGl0eVxuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5UmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgbmV3bHkgY3JlYXRlZCByZWltYnVyc2VtZW50IGVsaWdpYmlsaXR5XG4gICAgICogZGF0YVxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBjcmVhdGVSZWltYnVyc2VtZW50RWxpZ2liaWxpdHk/KGNyZWF0ZVJlaW1idXJzZW1lbnRFbGlnaWJpbGl0eUlucHV0OiBDcmVhdGVSZWltYnVyc2VtZW50RWxpZ2liaWxpdHlJbnB1dCk6IFByb21pc2U8UmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5UmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byB1cGRhdGUgYW4gZXhpc3RlbnQgcmVpbWJ1cnNlbWVudCBlbGlnaWJpbGl0eSdzIGRldGFpbHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXBkYXRlUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5SW5wdXQgdGhlIHJlaW1idXJzZW1lbnQgZWxpZ2liaWxpdHkgZGV0YWlscyB0byBiZSBwYXNzZWQgaW4sXG4gICAgICogaW4gb3JkZXIgdG8gdXBkYXRlIGFuIGV4aXN0aW5nIHJlaW1idXJzZW1lbnQgZWxpZ2liaWxpdHlcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEge0BsaW5rIFJlaW1idXJzZW1lbnRFbGlnaWJpbGl0eVJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIHVwZGF0ZWQgcmVpbWJ1cnNlbWVudCBlbGlnaWJpbGl0eVxuICAgICAqIGRhdGFcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgdXBkYXRlUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5Pyh1cGRhdGVSZWltYnVyc2VtZW50RWxpZ2liaWxpdHlJbnB1dDogVXBkYXRlUmVpbWJ1cnNlbWVudEVsaWdpYmlsaXR5SW5wdXQpOiBQcm9taXNlPFJlaW1idXJzZW1lbnRFbGlnaWJpbGl0eVJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gZ2V0IGFsbCB0cmFuc2FjdGlvbnMsIGZvciBhIHBhcnRpY3VsYXIgdXNlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBnZXRUcmFuc2FjdGlvbklucHV0IHRoZSB0cmFuc2FjdGlvbiBpbnB1dCBvYmplY3QgdG8gYmUgcGFzc2VkIGluLFxuICAgICAqIGNvbnRhaW5pbmcgYWxsIHRoZSBuZWNlc3NhcnkgZmlsdGVyaW5nIGZvciByZXRyaWV2aW5nIHRoZSB0cmFuc2FjdGlvbnMgZm9yIGEgcGFydGljdWxhciB1c2VyLlxuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgTW9vbmJlYW1UcmFuc2FjdGlvbnNSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZSB0cmFuc2FjdGlvbmFsIGRhdGEuXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldFRyYW5zYWN0aW9uPyhnZXRUcmFuc2FjdGlvbklucHV0OiBHZXRUcmFuc2FjdGlvbklucHV0KTogUHJvbWlzZTxNb29uYmVhbVRyYW5zYWN0aW9uc1Jlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gZ2V0IGFsbCB0cmFuc2FjdGlvbnMsIGZvciBhIHBhcnRpY3VsYXIgdXNlciwgZmlsdGVyZWRcbiAgICAgKiBieSB0aGVpciBzdGF0dXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZ2V0VHJhbnNhY3Rpb25CeVN0YXR1c0lucHV0IHRoZSB0cmFuc2FjdGlvbiBieSBzdGF0dXMgaW5wdXQgb2JqZWN0IHRvIGJlIHBhc3NlZCBpbixcbiAgICAgKiBjb250YWluaW5nIGFsbCB0aGUgbmVjZXNzYXJ5IGZpbHRlcmluZyBmb3IgcmV0cmlldmluZyB0aGUgdHJhbnNhY3Rpb25zLlxuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgTW9vbmJlYW1UcmFuc2FjdGlvbnNCeVN0YXR1c1Jlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIHRyYW5zYWN0aW9uYWwgZGF0YSxcbiAgICAgKiBmaWx0ZXJlZCBieSBzdGF0dXMgcmVzcG9uc2VcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0VHJhbnNhY3Rpb25CeVN0YXR1cz8oZ2V0VHJhbnNhY3Rpb25CeVN0YXR1c0lucHV0OiBHZXRUcmFuc2FjdGlvbkJ5U3RhdHVzSW5wdXQpOiBQcm9taXNlPE1vb25iZWFtVHJhbnNhY3Rpb25zQnlTdGF0dXNSZXNwb25zZT47XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIHVwZGF0ZSBhbiBleGlzdGluZyB0cmFuc2FjdGlvbidzIGRldGFpbHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXBkYXRlVHJhbnNhY3Rpb25JbnB1dCB0aGUgdHJhbnNhY3Rpb24gZGV0YWlscyB0byBiZSBwYXNzZWQgaW4sIGluIG9yZGVyIHRvIHVwZGF0ZVxuICAgICAqIGFuIGV4aXN0aW5nIHRyYW5zYWN0aW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIHtAbGluayBNb29uYmVhbVVwZGF0ZWRUcmFuc2FjdGlvblJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIHVwZGF0ZWQgdHJhbnNhY3Rpb25cbiAgICAgKiBkYXRhXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHVwZGF0ZVRyYW5zYWN0aW9uPyh1cGRhdGVUcmFuc2FjdGlvbklucHV0OiBVcGRhdGVUcmFuc2FjdGlvbklucHV0KTogUHJvbWlzZTxNb29uYmVhbVVwZGF0ZWRUcmFuc2FjdGlvblJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gZ2V0IHJlaW1idXJzZW1lbnRzIGZvciBhIHBhcnRpY3VsYXIgdXNlciwgZmlsdGVyZWQgYnkgdGhlaXIgc3RhdHVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGdldFJlaW1idXJzZW1lbnRCeVN0YXR1c0lucHV0IHRoZSByZWltYnVyc2VtZW50IGJ5IHN0YXR1cyBpbnB1dCwgY29udGFpbmluZyB0aGUgZmlsdGVyaW5nIHN0YXR1c1xuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgUmVpbWJ1cnNlbWVudEJ5U3RhdHVzUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgbWF0Y2hlZCByZWltYnVyc2VtZW50IGluZm9ybWF0aW9uLCBmaWx0ZXJlZCBieSBzdGF0dXNcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0UmVpbWJ1cnNlbWVudEJ5U3RhdHVzPyhnZXRSZWltYnVyc2VtZW50QnlTdGF0dXNJbnB1dDogR2V0UmVpbWJ1cnNlbWVudEJ5U3RhdHVzSW5wdXQpOiBQcm9taXNlPFJlaW1idXJzZW1lbnRCeVN0YXR1c1Jlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gY3JlYXRlIGEgcmVpbWJ1cnNlbWVudCBpbnRlcm5hbGx5LCBmcm9tIGFuIGluY29taW5nIHRyaWdnZXIgb2J0YWluZWQgZnJvbSB0aGVcbiAgICAgKiByZWltYnVyc2VtZW50cyB0cmlnZ2VyIExhbWJkYS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjcmVhdGVSZWltYnVyc2VtZW50SW5wdXQgdGhlIHJlaW1idXJzZW1lbnQgaW5wdXQgcGFzc2VkIGluIGZyb20gdGhlIGNyb24gTGFtYmRhIHRyaWdnZXJcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEge0BsaW5rIFJlaW1idXJzZW1lbnRSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZSByZWltYnVyc2VtZW50IGRldGFpbHMgdGhhdCB3ZXJlIHN0b3JlZFxuICAgICAqIGluIER5bmFtbyBEQlxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBjcmVhdGVSZWltYnVyc2VtZW50PyhjcmVhdGVSZWltYnVyc2VtZW50SW5wdXQ6IENyZWF0ZVJlaW1idXJzZW1lbnRJbnB1dCk6IFByb21pc2U8UmVpbWJ1cnNlbWVudFJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gdXBkYXRlIGFuIGV4aXN0aW5nIHJlaW1idXJzZW1lbnQncyBkZXRhaWxzLCBmcm9tIGFuIGluY29taW5nIHRyaWdnZXIgb2J0YWluZWQgZnJvbSB0aGVcbiAgICAgKiByZWltYnVyc2VtZW50cyB0cmlnZ2VyIExhbWJkYS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1cGRhdGVSZWltYnVyc2VtZW50SW5wdXQgdGhlIHJlaW1idXJzZW1lbnQgaW5wdXQgcGFzc2VkIGluIGZyb20gdGhlIGNyb24gTGFtYmRhIHRyaWdnZXIsIHRvIGJlIHVzZWRcbiAgICAgKiB3aGlsZSB1cGRhdGluZyBhbiBleGlzdGVudCByZWltYnVyc2VtZW50J3MgZGV0YWlsc1xuICAgICAqXG4gICAgICogQHJldHVybnMgYSB7QGxpbmsgUmVpbWJ1cnNlbWVudFJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIHJlaW1idXJzZW1lbnQgZGV0YWlscyB0aGF0IHdlcmUgdXBkYXRlZFxuICAgICAqIGluIER5bmFtbyBEQlxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCB1cGRhdGVSZWltYnVyc2VtZW50Pyh1cGRhdGVSZWltYnVyc2VtZW50SW5wdXQ6IFVwZGF0ZVJlaW1idXJzZW1lbnRJbnB1dCk6IFByb21pc2U8UmVpbWJ1cnNlbWVudFJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gc2VuZCBhIG5ldyBtaWxpdGFyeSB2ZXJpZmljYXRpb24gc3RhdHVzIGFja25vd2xlZGdtZW50LCBzbyB3ZSBjYW4ga2ljay1zdGFydCB0aGUgbWlsaXRhcnkgdmVyaWZpY2F0aW9uXG4gICAgICogc3RhdHVzIHVwZGF0ZSBub3RpZmljYXRpb24gcHJvY2VzcyB0aHJvdWdoIHRoZSBwcm9kdWNlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBtaWxpdGFyeVZlcmlmaWNhdGlvbk5vdGlmaWNhdGlvblVwZGF0ZSBtaWxpdGFyeSB2ZXJpZmljYXRpb24gdXBkYXRlIG9iamVjdFxuICAgICAqXG4gICAgICogQHJldHVybiBhIHtAbGluayBQcm9taXNlfSBvZiB7QGxpbmsgQVBJR2F0ZXdheVByb3h5UmVzdWx0fSByZXByZXNlbnRpbmcgdGhlIEFQSSBHYXRld2F5IHJlc3VsdFxuICAgICAqIHNlbnQgYnkgdGhlIG1pbGl0YXJ5IHZlcmlmaWNhdGlvbiB1cGRhdGUgcHJvZHVjZXIgTGFtYmRhLCB0byB2YWxpZGF0ZSB3aGV0aGVyIHRoZSBtaWxpdGFyeSB2ZXJpZmljYXRpb25cbiAgICAgKiBub3RpZmljYXRpb24gdXBkYXRlIHByb2Nlc3Mga2ljay1zdGFydGVkIG9yIG5vdFxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBtaWxpdGFyeVZlcmlmaWNhdGlvblVwZGF0ZXNBY2tub3dsZWRnbWVudD8obWlsaXRhcnlWZXJpZmljYXRpb25Ob3RpZmljYXRpb25VcGRhdGU6IE1pbGl0YXJ5VmVyaWZpY2F0aW9uTm90aWZpY2F0aW9uVXBkYXRlKTogUHJvbWlzZTxBUElHYXRld2F5UHJveHlSZXN1bHQ+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBzZW5kIGEgbmV3IHJlaW1idXJzZW1lbnQgYWNrbm93bGVkZ21lbnQsIGZvciBhbiBlbGlnaWJsZSB1c2VyIHdpdGhcbiAgICAgKiBhIGxpbmtlZCBjYXJkLCBzbyB3ZSBjYW4ga2ljay1zdGFydCB0aGUgcmVpbWJ1cnNlbWVudCBwcm9jZXNzIHRocm91Z2ggdGhlIHJlaW1idXJzZW1lbnRcbiAgICAgKiBwcm9kdWNlclxuICAgICAqXG4gICAgICogQHBhcmFtIGVsaWdpYmxlTGlua2VkVXNlciBlbGlnaWJsZSBsaW5rZWQgdXNlciBvYmplY3QgdG8gYmUgcGFzc2VkIGluXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBBUElHYXRld2F5UHJveHlSZXN1bHR9IHJlcHJlc2VudGluZyB0aGUgQVBJIEdhdGV3YXkgcmVzdWx0XG4gICAgICogc2VudCBieSB0aGUgcmVpbWJ1cnNlbWVudCBwcm9kdWNlciBMYW1iZGEsIHRvIHZhbGlkYXRlIHdoZXRoZXIgdGhlIHJlaW1idXJzZW1lbnQgcHJvY2VzcyB3YXNcbiAgICAgKiBraWNrLXN0YXJ0ZWQgb3Igbm90XG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHJlaW1idXJzZW1lbnRzQWNrbm93bGVkZ21lbnQ/KGVsaWdpYmxlTGlua2VkVXNlcjogRWxpZ2libGVMaW5rZWRVc2VyKTogUHJvbWlzZTxBUElHYXRld2F5UHJveHlSZXN1bHQ+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBzZW5kIGEgbmV3IHRyYW5zYWN0aW9uIGFja25vd2xlZGdtZW50LCBmb3IgYW4gdXBkYXRlZCB0cmFuc2FjdGlvbiwgc28gd2UgY2FuIGtpY2stc3RhcnQgdGhlXG4gICAgICogdHJhbnNhY3Rpb24gcHJvY2VzcyB0aHJvdWdoIHRoZSB0cmFuc2FjdGlvbiBwcm9kdWNlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1cGRhdGVkVHJhbnNhY3Rpb25FdmVudCB1cGRhdGVkIHRyYW5zYWN0aW9uIGV2ZW50IHRvIGJlIHBhc3NlZCBpblxuICAgICAqXG4gICAgICogQHJldHVybiBhIHtAbGluayBQcm9taXNlfSBvZiB7QGxpbmsgQVBJR2F0ZXdheVByb3h5UmVzdWx0fSByZXByZXNlbnRpbmcgdGhlIEFQSSBHYXRld2F5IHJlc3VsdFxuICAgICAqIHNlbnQgYnkgdGhlIHJlaW1idXJzZW1lbnQgcHJvZHVjZXIgTGFtYmRhLCB0byB2YWxpZGF0ZSB3aGV0aGVyIHRoZSB0cmFuc2FjdGlvbnMgcHJvY2VzcyB3YXNcbiAgICAgKiBraWNrLXN0YXJ0ZWQgb3Igbm90LlxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCB0cmFuc2FjdGlvbnNBY2tub3dsZWRnbWVudD8odXBkYXRlZFRyYW5zYWN0aW9uRXZlbnQ6IFVwZGF0ZWRUcmFuc2FjdGlvbkV2ZW50KTogUHJvbWlzZTxBUElHYXRld2F5UHJveHlSZXN1bHQ+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBjcmVhdGUgYSBuZXcgdHJhbnNhY3Rpb24gaW50ZXJuYWxseSwgZnJvbSBhbiBpbmNvbWluZyB0cmFuc2FjdGlvblxuICAgICAqIG9idGFpbmVkIGZyb20gdGhlIFNRUyBtZXNzYWdlL2V2ZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gdHJhbnNhY3Rpb24gcGFzc2VkIGluIGZyb20gdGhlIFNRUyBtZXNzYWdlL2V2ZW50XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBNb29uYmVhbVRyYW5zYWN0aW9uUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgdHJhbnNhY3Rpb25cbiAgICAgKiBkZXRhaWxzIHRoYXQgd2VyZSBzdG9yZWQgaW4gRHluYW1vIERCXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGNyZWF0ZVRyYW5zYWN0aW9uPyh0cmFuc2FjdGlvbjogTW9vbmJlYW1UcmFuc2FjdGlvbik6IFByb21pc2U8TW9vbmJlYW1UcmFuc2FjdGlvblJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gcmV0cmlldmUgdGhlIGxpc3Qgb2YgZWxpZ2libGUgbGlua2VkIHVzZXJzLCB0byBiZSB1c2VyIGR1cmluZyB0aGUgcmVpbWJ1cnNlbWVudHNcbiAgICAgKiBwcm9jZXNzLlxuICAgICAqXG4gICAgICogQHJldHVybiBhIHtsaW5rIFByb21pc2V9IG9mIHtAbGluayBFbGlnaWJsZUxpbmtlZFVzZXJzUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBlbGlnaWJsZVxuICAgICAqIHVzZXJzXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldEVsaWdpYmxlTGlua2VkVXNlcnM/KCk6IFByb21pc2U8RWxpZ2libGVMaW5rZWRVc2Vyc1Jlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gdmVyaWZ5IGFuIGluZGl2aWR1YWxzIG1pbGl0YXJ5IHNlcnZpY2Ugc3RhdHVzLlxuICAgICAqXG4gICAgICogQHJldHVybiBhIHtAbGluayBQcm9taXNlfSBvZiB7QGxpbmsgTWlsaXRhcnlWZXJpZmljYXRpb25TdGF0dXNUeXBlfSByZXByZXNlbnRpbmcgdGhlXG4gICAgICogbWlsaXRhcnkgdmVyaWZpY2F0aW9uIHN0YXR1cyBvYnRhaW5lZCBmcm9tIHRoZSBjbGllbnQgdmVyaWZpY2F0aW9uIGNhbGxcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgdmVyaWZ5PygpOiBQcm9taXNlPE1pbGl0YXJ5VmVyaWZpY2F0aW9uU3RhdHVzVHlwZT47XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIGNvbXBsZXRlIHRoZSBsaW5raW5nIG9mIGFuIGluZGl2aWR1YWwncyBjYXJkIG9uIHRoZSBwbGF0Zm9ybS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VySWQgdW5pcXVlIHVzZXIgSUQgb2YgYSBjYXJkIGxpbmtpbmcgdXNlci5cbiAgICAgKiBAcGFyYW0gY3JlYXRlZEF0IGNhcmQgbGlua2VkIG9iamVjdCBjcmVhdGlvbiBkYXRlXG4gICAgICogQHBhcmFtIHVwZGF0ZWRBdCBjYXJkIGxpbmtlZCBvYmplY3QgdXBkYXRlIGRhdGVcbiAgICAgKiBAcGFyYW0gY2FyZCBjYXJkIGluZm9ybWF0aW9uIHRvIGJlIHVzZWQgZHVyaW5nIHRoZSBlbnJvbGxtZW50L2xpbmtpbmcgcHJvY2Vzc1xuICAgICAqXG4gICAgICogQHJldHVybiBhIHtAbGluayBQcm9taXNlfSBvZiB7QGxpbmsgQ2FyZExpbmtSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZVxuICAgICAqIGNhcmQgbGluayByZXNwb25zZSBvYmplY3Qgb2J0YWluZWQgZnJvbSB0aGUgbGlua2luZyBjYWxsXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGxpbms/KHVzZXJJZDogc3RyaW5nLCBjcmVhdGVkQXQ6IHN0cmluZywgdXBkYXRlZEF0OiBzdHJpbmcsIGNhcmQ6IENhcmQpOiBQcm9taXNlPENhcmRMaW5rUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byBhZGQgYSBuZXcgY2FyZCB0byBhbiBleGlzdGluZyBtZW1iZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlcklkIHVuaXF1ZSB1c2VyIElEIG9mIGEgY2FyZCBsaW5raW5nIHVzZXIuXG4gICAgICogQHBhcmFtIG1lbWJlcklkIG1lbWJlciBpZCwgcmV0cmlldmVkIGZyb20gT2xpdmUsIHdoaWNoIHRoZSBjYXJkIHdpbGwgYmUgYWRkZWQgdG9cbiAgICAgKiBAcGFyYW0gY3JlYXRlZEF0IGNhcmQgbGlua2VkIG9iamVjdCBjcmVhdGlvbiBkYXRlXG4gICAgICogQHBhcmFtIHVwZGF0ZWRBdCBjYXJkIGxpbmtlZCBvYmplY3QgdXBkYXRlIGRhdGVcbiAgICAgKiBAcGFyYW0gY2FyZCBjYXJkIGluZm9ybWF0aW9uIHRvIGJlIHVzZWQgaW4gYWRkaW5nIGEgbmV3IGNhcmQgdG8gYSBtZW1iZXJcbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSB7QGxpbmsgUHJvbWlzZX0gb2Yge0BsaW5rIENhcmRMaW5rUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGVcbiAgICAgKiBjYXJkIGxpbmsgcmVzcG9uc2Ugb2JqZWN0IG9idGFpbmVkIGZyb20gdGhlIGFkZCBjYXJkIGNhbGxcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgYWRkQ2FyZD8odXNlcklkOiBzdHJpbmcsIG1lbWJlcklkOiBzdHJpbmcsIGNyZWF0ZWRBdDogc3RyaW5nLCB1cGRhdGVkQXQ6IHN0cmluZywgY2FyZDogQ2FyZCk6IFByb21pc2U8Q2FyZExpbmtSZXNwb25zZT47XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIHVwZGF0ZSBhIG1lbWJlcidzIHN0YXR1cywgdG8gZWl0aGVyIGFjdGl2ZSBvciBpbmFjdGl2ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VySWQgdW5pcXVlIHVzZXIgSUQgb2YgYSBjYXJkIGxpbmtpbmcgdXNlci5cbiAgICAgKiBAcGFyYW0gbWVtYmVySWQgbWVtYmVyIGlkLCByZXRyaWV2ZWQgZnJvbSBPbGl2ZSwgd2hpY2ggdGhlIHN0YXR1cyB3aWxsIGJlIHVwZGF0ZWQgZm9yXG4gICAgICogQHBhcmFtIG1lbWJlckZsYWcgZmxhZyB0byBpbmRpY2F0ZSB3aGF0IHRoZSBzdGF0dXMgb2YgdGhlIG1lbWJlciwgd2lsbCBiZSB1cGRhdGVkIHRvXG4gICAgICogQHBhcmFtIHVwZGF0ZWRBdCBjYXJkIGxpbmtlZCBvYmplY3QgdXBkYXRlIGRhdGVcbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSB7QGxpbmsgUHJvbWlzZX0gb2Yge0BsaW5rIE1lbWJlclJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlXG4gICAgICogbWVtYmVyJ3MgY29udGVudHMgYWZ0ZXIgdGhlIHVwZGF0ZSBpcyBwZXJmb3JtZWRcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgdXBkYXRlTWVtYmVyU3RhdHVzPyh1c2VySWQ6IHN0cmluZywgbWVtYmVySWQ6IHN0cmluZywgbWVtYmVyRmxhZzogYm9vbGVhbiwgdXBkYXRlZEF0OiBzdHJpbmcpOiBQcm9taXNlPE1lbWJlclJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gcmVtb3ZlL2RlYWN0aXZhdGUgYSBjYXJkLCBnaXZlbiBpdHMgSUQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2FyZElkIHRoZSBpZCBvZiB0aGUgY2FyZCB0byBiZSByZW1vdmVkL2RlbGV0ZWQvZGVhY3RpdmF0ZWRcbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSB7QGxpbmsgUHJvbWlzZX0gb2Yge0BsaW5rIFJlbW92ZUNhcmRSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZVxuICAgICAqIGNhcmQgcmVtb3ZhbCByZXNwb25zZS5cbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgcmVtb3ZlQ2FyZD8oY2FyZElkOiBzdHJpbmcpOiBQcm9taXNlPFJlbW92ZUNhcmRSZXNwb25zZT47XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIHJldHJpZXZlIHRoZSBicmFuZCBkZXRhaWxzLCBnaXZlbiBhIGJyYW5kIElELlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIHRoZSB0cmFuc2FjdGlvbiBvYmplY3QsIHBvcHVsYXRlZCBieSB0aGUgaW5pdGlhbCBkZXRhaWxzXG4gICAgICogcGFzc2VkIGluIGJ5IE9saXZlLiBUaGlzIG9iamVjdCB3aWxsIGJlIHVzZWQgdG8gc2V0IGV2ZW4gbW9yZSBpbmZvcm1hdGlvbiBmb3JcbiAgICAgKiBpdCwgb2J0YWluZWQgZnJvbSB0aGlzIGJyYW5kIGNhbGwuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBUcmFuc2FjdGlvblJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlIHRyYW5zYWN0aW9uXG4gICAgICogd2l0aCB0aGUgYnJhbmQgZGV0YWlscyBvYnRhaW5lZCwgaW5jbHVkZWQgaW4gaXQuXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldEJyYW5kRGV0YWlscz8odHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUHJvbWlzZTxUcmFuc2FjdGlvblJlc3BvbnNlPjtcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVzZWQgdG8gcmV0cmlldmUgdGhlIHN0b3JlIGRldGFpbHMsIGdpdmVuIGEgc3RvcmUgSUQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gdGhlIHRyYW5zYWN0aW9uIG9iamVjdCwgcG9wdWxhdGVkIGJ5IHRoZSBpbml0aWFsIGRldGFpbHNcbiAgICAgKiBwYXNzZWQgaW4gYnkgT2xpdmUuIFRoaXMgb2JqZWN0IHdpbGwgYmUgdXNlZCB0byBzZXQgZXZlbiBtb3JlIGluZm9ybWF0aW9uIGZvclxuICAgICAqIGl0LCBvYnRhaW5lZCBmcm9tIHRoaXMgYnJhbmQgY2FsbC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSB7QGxpbmsgUHJvbWlzZX0gb2Yge0BsaW5rIFRyYW5zYWN0aW9uUmVzcG9uc2V9IHJlcHJlc2VudGluZyB0aGUgdHJhbnNhY3Rpb25cbiAgICAgKiB3aXRoIHRoZSBzdG9yZSBkZXRhaWxzIG9idGFpbmVkLCBpbmNsdWRlZCBpbiBpdC5cbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgZ2V0U3RvcmVEZXRhaWxzPyh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byByZXRyaWV2ZSB0aGUgbWVtYmVyIGRldGFpbHMsIHNwZWNpZmljYWxseSB0aGUgZXh0TWVtYmVySWQsIHdoaWNoIGlzIE1vb25iZWFtJ3MgdW5pcXVlIHVzZXIgSURcbiAgICAgKiBzZXQgYXQgY3JlYXRpb24gdGltZSwgZ2l2ZW4gYSBtZW1iZXIgSUQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVtYmVySWQgbWVtYmVyIElEIG9idGFpbmVkIGZyb20gT2xpdmUgYXQgY3JlYXRpb24gdGltZSwgdXNlZCB0byByZXRyaWV2ZSB0aGVcbiAgICAgKiBvdGhlciBtZW1iZXIgZGV0YWlscy5cbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSB7QGxpbmsgUHJvbWlzZX0gb2Yge0BsaW5rIE1lbWJlckRldGFpbHNSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZSBtZW1iZXIgZGV0YWlsc1xuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRNZW1iZXJEZXRhaWxzPyhtZW1iZXJJZDogc3RyaW5nKTogUHJvbWlzZTxNZW1iZXJEZXRhaWxzUmVzcG9uc2U+O1xuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byByZXRyaWV2ZSB0aGUgdHJhbnNhY3Rpb24gZGV0YWlscywgZ2l2ZW4gYSB0cmFuc2FjdGlvbiBJRFxuICAgICAqICh1c2VkIGZvciB0cmFuc2FjdGlvbmFsIHB1cnBvc2VzKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiB0aGUgdHJhbnNhY3Rpb24gb2JqZWN0LCBwb3B1bGF0ZWQgYnkgdGhlIGluaXRpYWwgZGV0YWlsc1xuICAgICAqIHBhc3NlZCBpbiBieSBPbGl2ZS4gVGhpcyBvYmplY3Qgd2lsbCBiZSB1c2VkIHRvIHNldCBldmVuIG1vcmUgaW5mb3JtYXRpb24gZm9yXG4gICAgICogaXQsIG9idGFpbmVkIGZyb20gdGhpcyB0cmFuc2FjdGlvbiBkZXRhaWxzIGNhbGwuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBUcmFuc2FjdGlvblJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlXG4gICAgICogdHJhbnNhY3Rpb24gb2JqZWN0LCBwb3B1bGF0ZWQgd2l0aCB0aGUgYWRkaXRpb25hbCB0cmFuc2FjdGlvbiBkZXRhaWxzIHRoYXRcbiAgICAgKiB3ZSByZXRyaWV2ZWQuXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGdldFRyYW5zYWN0aW9uRGV0YWlscz8odHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUHJvbWlzZTxUcmFuc2FjdGlvblJlc3BvbnNlPlxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXNlZCB0byByZXRyaWV2ZSB0aGUgdHJhbnNhY3Rpb24gZGV0YWlscywgZ2l2ZW4gYSB0cmFuc2FjdGlvbiBJRCAodXNlZCBmb3IgdXBkYXRlZFxuICAgICAqIHRyYW5zYWN0aW9uYWwgZXZlbnRzIHB1cnBvc2VzKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1cGRhdGVkVHJhbnNhY3Rpb25FdmVudCB0aGUgdXBkYXRlZCB0cmFuc2FjdGlvbiBldmVudCBvYmplY3QsIHBvcHVsYXRlZCBieSB0aGVcbiAgICAgKiBpbml0aWFsIGRldGFpbHMgcGFzc2VkIGJ5IE9saXZlIGluIHRoZSB1cGRhdGVkIHdlYmhvb2sgY2FsbC4gVGhpcyBvYmplY3Qgd2lsbCBiZSB1c2VkXG4gICAgICogdG8gc2V0IGV2ZW4gbW9yZSBpbmZvcm1hdGlvbiBmb3IgaXQsIG9idGFpbmVkIGZyb20gdGhpcyB0cmFuc2FjdGlvbiBkZXRhaWxzIGNhbGwuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBVcGRhdGVkVHJhbnNhY3Rpb25FdmVudFJlc3BvbnNlfSByZXByZXNlbnRpbmcgdGhlXG4gICAgICogdXBkYXRlZCB0cmFuc2FjdGlvbiBldmVudCBvYmplY3QsIHBvcHVsYXRlZCB3aXRoIHRoZSBhZGRpdGlvbmFsIHRyYW5zYWN0aW9uIGRldGFpbHNcbiAgICAgKiB0aGF0IHdlIHJldHJpZXZlZFxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRVcGRhdGVkVHJhbnNhY3Rpb25EZXRhaWxzPyh1cGRhdGVkVHJhbnNhY3Rpb25FdmVudDogVXBkYXRlZFRyYW5zYWN0aW9uRXZlbnQpOiBQcm9taXNlPFVwZGF0ZWRUcmFuc2FjdGlvbkV2ZW50UmVzcG9uc2U+XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1c2VkIHRvIHJldHJpZXZlIHRoZSB0cmFuc2FjdGlvbiBzdGF0dXMgZGV0YWlscywgZ2l2ZW4gYSB0cmFuc2FjdGlvbiBJRFxuICAgICAqICh1c2VkIGZvciByZWltYnVyc2VtZW50cyBwdXJwb3NlcykuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25JZCB0aGUgdHJhbnNhY3Rpb24gaWQsIHRvIGJlIHBhc3NlZCBpbiwgaW4gb3JkZXIgdG8gcmV0cmlldmVcbiAgICAgKiB0aGUgc3RhdHVzIGRldGFpbHMgbmVjZXNzYXJ5IGZvciByZWltYnVyc2VtZW50LXJlbGF0ZWQgcHVycG9zZXMuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGEge0BsaW5rIFByb21pc2V9IG9mIHtAbGluayBUcmFuc2FjdGlvblN0YXR1c0RldGFpbHNSZXNwb25zZX0gcmVwcmVzZW50aW5nIHRoZVxuICAgICAqIHRyYW5zYWN0aW9uIHN0YXR1cyBkZXRhaWxzIG9iamVjdCwgcG9wdWxhdGVkIHdpdGggdGhlIHRyYW5zYWN0aW9uIHN0YXR1cyBkZXRhaWxzIHRoYXQgd2UgcmV0cmlldmVkLlxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBnZXRUcmFuc2FjdGlvblN0YXR1cz8odHJhbnNhY3Rpb25JZDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2FjdGlvblN0YXR1c0RldGFpbHNSZXNwb25zZT5cbn1cbiJdfQ==