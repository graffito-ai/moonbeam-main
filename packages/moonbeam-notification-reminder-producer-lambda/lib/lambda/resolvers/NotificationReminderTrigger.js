"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.triggerNotificationReminder = void 0;
const moonbeam_models_1 = require("@moonbeam/moonbeam-models");
const client_sns_1 = require("@aws-sdk/client-sns");
/**
 * Function used to handle the daily notification reminder trigger, by first
 * determining whether a notification reminder needs to be sent out, and by
 * kick-starting that process for any applicable users, accordingly.
 */
const triggerNotificationReminder = async () => {
    try {
        // retrieving the current function region
        const region = process.env.AWS_REGION;
        /**
         * The overall notification reminder cron triggering, will be made up of the following steps:
         *
         * 1) Call the getNotificationReminders AppSync Query API in order to:
         *    - get any ACTIVE REMINDERS
         *    - for any ACTIVE reminders, sort through the ones that need to get triggered
         *
         * 2) For the reminders that are of:
         *    - CARD_LINKING_REMINDER type, call the getUsersWithNoCards
         *    AppSync Query API, in order to get all users to send notification reminders to.
         *
         *    - NEW_MAP_FEATURE_REMINDER type, call the getAllUsersForNotificationReminders AppSync Query
         *    API, in order to get all the users to send notification reminders to.
         *
         * 3) For each applicable user from step 2) drop a message into the appropriate SNS topic.
         *
         * 4) Once all users have been notified, then update the card linking reminder accordingly,
         * by calling the updateNotificationReminder AppSync Mutation API.
         *
         */
        const moonbeamClient = new moonbeam_models_1.MoonbeamClient(process.env.ENV_NAME, region);
        // 1) Call the getNotificationReminders Moonbeam AppSync Query API endpoint.
        const notificationReminders = await moonbeamClient.getNotificationReminders();
        // check to see if the get notification reminders call was successful or not.
        if (notificationReminders !== null && notificationReminders !== undefined && !notificationReminders.errorMessage &&
            !notificationReminders.errorType && notificationReminders.data !== null && notificationReminders.data !== undefined &&
            notificationReminders.data.length !== 0) {
            // filter through each ACTIVE notification reminder
            let activeReminderCount = 0;
            for (const reminder of notificationReminders.data) {
                if (reminder.notificationReminderStatus == moonbeam_models_1.NotificationReminderStatus.Active) {
                    //  sort through the ones that need to get triggered
                    const nextTriggerDate = new Date(Date.parse(reminder.nextTriggerAt));
                    const currentDate = new Date(Date.now());
                    if (nextTriggerDate.getDate() === currentDate.getDate() && nextTriggerDate.getMonth() === currentDate.getMonth() &&
                        nextTriggerDate.getFullYear() === currentDate.getFullYear()) {
                        // depending on the type of notifications that we're sending, act accordingly
                        switch (reminder.notificationReminderType) {
                            case moonbeam_models_1.NotificationReminderType.CardLinkingReminder:
                                console.log(`__________________________________________________________________________________________________________________________________`);
                                console.log(`Found new ACTIVE notification reminder ${reminder.id} of type ${moonbeam_models_1.NotificationReminderType.CardLinkingReminder}`);
                                // 2) For any ACTIVE reminders of type CARD_LINKING_REMINDER, call the getUsersWithNoCards Moonbeam AppSync Query API endpoint.
                                const usersWithNoCards = await moonbeamClient.getUsersWithNoCards();
                                // check if the get users with no card call was successful or not.
                                if (usersWithNoCards !== null && usersWithNoCards !== undefined && !usersWithNoCards.errorMessage &&
                                    !usersWithNoCards.errorType && usersWithNoCards.data !== null && usersWithNoCards.data !== undefined &&
                                    usersWithNoCards.data.length !== 0) {
                                    // 3) For each applicable user from step 2) drop a message into the appropriate SNS topic.
                                    let successfulUserMessagesSent = 0;
                                    for (const ineligibleUser of usersWithNoCards.data) {
                                        // initializing the SNS Client
                                        const snsClient = new client_sns_1.SNSClient({ region: region });
                                        /**
                                         * drop the ineligible user input as a message to the notification reminder processing topic
                                         */
                                        const userDetailsForNotifications = {
                                            id: ineligibleUser.id,
                                            email: ineligibleUser.email,
                                            firstName: ineligibleUser.firstName,
                                            lastName: ineligibleUser.lastName,
                                            notificationChannelType: reminder.notificationChannelType,
                                            notificationType: moonbeam_models_1.NotificationType.CardLinkingReminder
                                        };
                                        const notificationReminderReceipt = await snsClient.send(new client_sns_1.PublishCommand({
                                            TopicArn: process.env.NOTIFICATION_REMINDER_PROCESSING_TOPIC_ARN,
                                            Message: JSON.stringify(userDetailsForNotifications),
                                            /**
                                             * the message group id, will be represented by the Moonbeam internal user id, so that we can group the notification reminder update messages for a particular
                                             * user id, and sort them in the FIFO processing topic accordingly.
                                             */
                                            MessageGroupId: ineligibleUser.id
                                        }));
                                        // ensure that the notification reminder message was properly sent to the appropriate processing topic
                                        if (notificationReminderReceipt !== null && notificationReminderReceipt !== undefined && notificationReminderReceipt.MessageId &&
                                            notificationReminderReceipt.MessageId.length !== 0 && notificationReminderReceipt.SequenceNumber && notificationReminderReceipt.SequenceNumber.length !== 0) {
                                            // the notification reminder message has been successfully dropped into the topic, and will be picked up by the notification reminder consumer
                                            console.log(`Notification reminder successfully sent to topic for processing with receipt information: ${notificationReminderReceipt.MessageId} ${notificationReminderReceipt.SequenceNumber}`);
                                            // increase the number of messages sent to the topic
                                            successfulUserMessagesSent += 1;
                                        }
                                        else {
                                            /**
                                             * no need for further actions, since this error will be logged and nothing will execute further.
                                             * in the future we might need some alerts and metrics emitting here
                                             */
                                            console.log(`Unexpected error while sending the notification reminder for user ${ineligibleUser.id}`);
                                        }
                                    }
                                    // check if all applicable users have had successful messages dropped in the notification reminder topic
                                    if (successfulUserMessagesSent === usersWithNoCards.data.length) {
                                        console.log(`__________________________________________________________________________________________________________________________________`);
                                        console.log(`Notification reminder successfully sent for users:\n${JSON.stringify(usersWithNoCards.data)}`);
                                        /**
                                         * 4) Once all users have been notified, then update the card linking reminder accordingly,
                                         * by calling the updateNotificationReminder AppSync Mutation API.
                                         */
                                        const updateNotificationReminderResponse = await moonbeamClient.updateNotificationReminder({
                                            id: reminder.id,
                                            notificationReminderStatus: moonbeam_models_1.NotificationReminderStatus.Active
                                        });
                                        // check if the update notification reminder call was successful or not.
                                        if (updateNotificationReminderResponse !== null && updateNotificationReminderResponse !== undefined &&
                                            !updateNotificationReminderResponse.errorMessage && !updateNotificationReminderResponse.errorType &&
                                            updateNotificationReminderResponse.data !== undefined && updateNotificationReminderResponse.data !== null &&
                                            updateNotificationReminderResponse.data.length !== 0) {
                                            console.log(`Notification reminder ${reminder.id} successfully updated`);
                                        }
                                        else {
                                            /**
                                             * no need for further actions, since this error will be logged and nothing will execute further.
                                             * in the future we might need some alerts and metrics emitting here
                                             */
                                            console.log(`Update notification reminder through UPDATE notification reminder call failed`);
                                        }
                                    }
                                    else {
                                        /**
                                         * no need for further actions, since this error will be logged and nothing will execute further.
                                         * in the future we might need some alerts and metrics emitting here
                                         */
                                        console.log(`Not all applicable users have had notification events dropped in the appropriate topic. Re-process these failed messages accordingly.`);
                                    }
                                }
                                else {
                                    /**
                                     * no need for further actions, since this error will be logged and nothing will execute further.
                                     * in the future we might need some alerts and metrics emitting here
                                     */
                                    console.log(`Users with no cards retrieval through GET users with no cards call failed`);
                                }
                                break;
                            case moonbeam_models_1.NotificationReminderType.NewMapFeatureReminder:
                                console.log(`__________________________________________________________________________________________________________________________________`);
                                console.log(`Found new ACTIVE notification reminder ${reminder.id} of type ${moonbeam_models_1.NotificationReminderType.NewMapFeatureReminder}`);
                                // 2) For any ACTIVE reminders of type NEW_MAP_FEATURE_REMINDER, call the getAllUsersForNotificationReminders Moonbeam AppSync Query API endpoint.
                                const allUsersForNotificationReminder = await moonbeamClient.getAllUsersForNotificationReminders();
                                // check if the get all users for notification reminders call was successful or not.
                                if (allUsersForNotificationReminder !== null && allUsersForNotificationReminder !== undefined && !allUsersForNotificationReminder.errorMessage &&
                                    !allUsersForNotificationReminder.errorType && allUsersForNotificationReminder.data !== null && allUsersForNotificationReminder.data !== undefined &&
                                    allUsersForNotificationReminder.data.length !== 0) {
                                    // 3) For each applicable user from step 2) drop a message into the appropriate SNS topic.
                                    let successfulUserMessagesSent = 0;
                                    for (const user of allUsersForNotificationReminder.data) {
                                        // ToDo: Remove this after Google Approves us
                                        if (user.email === 'marius@moonbeam.vet' || user.email === 'johnluke@moonbeam.vet') {
                                            // initializing the SNS Client
                                            const snsClient = new client_sns_1.SNSClient({ region: region });
                                            /**
                                             * drop the ineligible user input as a message to the notification reminder processing topic
                                             */
                                            const userDetailsForNotifications = {
                                                id: user.id,
                                                email: user.email,
                                                firstName: user.firstName,
                                                lastName: user.lastName,
                                                notificationChannelType: reminder.notificationChannelType,
                                                notificationType: moonbeam_models_1.NotificationType.NewMapFeatureReminder
                                            };
                                            const notificationReminderReceipt = await snsClient.send(new client_sns_1.PublishCommand({
                                                TopicArn: process.env.NOTIFICATION_REMINDER_PROCESSING_TOPIC_ARN,
                                                Message: JSON.stringify(userDetailsForNotifications),
                                                /**
                                                 * the message group id, will be represented by the Moonbeam internal user id, so that we can group the notification reminder update messages for a particular
                                                 * user id, and sort them in the FIFO processing topic accordingly.
                                                 */
                                                MessageGroupId: user.id
                                            }));
                                            // ensure that the notification reminder message was properly sent to the appropriate processing topic
                                            if (notificationReminderReceipt !== null && notificationReminderReceipt !== undefined && notificationReminderReceipt.MessageId &&
                                                notificationReminderReceipt.MessageId.length !== 0 && notificationReminderReceipt.SequenceNumber && notificationReminderReceipt.SequenceNumber.length !== 0) {
                                                // the notification reminder message has been successfully dropped into the topic, and will be picked up by the notification reminder consumer
                                                console.log(`Notification reminder successfully sent to topic for processing with receipt information: ${notificationReminderReceipt.MessageId} ${notificationReminderReceipt.SequenceNumber}`);
                                                // increase the number of messages sent to the topic
                                                successfulUserMessagesSent += 1;
                                            }
                                            else {
                                                /**
                                                 * no need for further actions, since this error will be logged and nothing will execute further.
                                                 * in the future we might need some alerts and metrics emitting here
                                                 */
                                                console.log(`Unexpected error while sending the notification reminder for user ${user.id}`);
                                            }
                                        }
                                    }
                                    // check if all applicable users have had successful messages dropped in the notification reminder topic
                                    if (successfulUserMessagesSent === allUsersForNotificationReminder.data.length) {
                                        console.log(`__________________________________________________________________________________________________________________________________`);
                                        console.log(`Notification reminder successfully sent for users:\n${JSON.stringify(allUsersForNotificationReminder.data)}`);
                                        /**
                                         * 4) Once all users have been notified, then update the card linking reminder accordingly,
                                         * by calling the updateNotificationReminder AppSync Mutation API.
                                         */
                                        const updateNotificationReminderResponse = await moonbeamClient.updateNotificationReminder({
                                            id: reminder.id,
                                            notificationReminderStatus: moonbeam_models_1.NotificationReminderStatus.Active
                                        });
                                        // check if the update notification reminder call was successful or not.
                                        if (updateNotificationReminderResponse !== null && updateNotificationReminderResponse !== undefined &&
                                            !updateNotificationReminderResponse.errorMessage && !updateNotificationReminderResponse.errorType &&
                                            updateNotificationReminderResponse.data !== undefined && updateNotificationReminderResponse.data !== null &&
                                            updateNotificationReminderResponse.data.length !== 0) {
                                            console.log(`Notification reminder ${reminder.id} successfully updated`);
                                        }
                                        else {
                                            /**
                                             * no need for further actions, since this error will be logged and nothing will execute further.
                                             * in the future we might need some alerts and metrics emitting here
                                             */
                                            console.log(`Update notification reminder through UPDATE notification reminder call failed`);
                                        }
                                    }
                                    else {
                                        /**
                                         * no need for further actions, since this error will be logged and nothing will execute further.
                                         * in the future we might need some alerts and metrics emitting here
                                         */
                                        console.log(`Not all applicable users have had notification events dropped in the appropriate topic. Re-process these failed messages accordingly.`);
                                    }
                                }
                                else {
                                    /**
                                     * no need for further actions, since this error will be logged and nothing will execute further.
                                     * in the future we might need some alerts and metrics emitting here
                                     */
                                    console.log(`Users for notification reminders retrieval through GET all users for notification reminders call failed`);
                                }
                                break;
                            default:
                                console.log(`Unknown notification reminder type passed in for ACTIVE reminder ${reminder.notificationReminderType}`);
                        }
                        activeReminderCount += 1;
                    }
                }
            }
            console.log(`__________________________________________________________________________________________________________________________________`);
            console.log(`Ran trigger for Notification Reminders at ${new Date(Date.now()).toISOString()}, and found ${activeReminderCount} ACTIVE reminders`);
        }
        else {
            /**
             * no need for further actions, since this error will be logged and nothing will execute further.
             * in the future we might need some alerts and metrics emitting here
             */
            console.log(`Notification Reminder retrieval through GET notification reminders call failed`);
        }
    }
    catch (error) {
        /**
         * no need for further actions, since this error will be logged and nothing will execute further.
         * in the future we might need some alerts and metrics emitting here
         */
        console.log(`Unexpected error while processing the notification reminder cron event ${error}`);
    }
};
exports.triggerNotificationReminder = triggerNotificationReminder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90aWZpY2F0aW9uUmVtaW5kZXJUcmlnZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xhbWJkYS9yZXNvbHZlcnMvTm90aWZpY2F0aW9uUmVtaW5kZXJUcmlnZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtEQVFtQztBQUNuQyxvREFBOEQ7QUFFOUQ7Ozs7R0FJRztBQUNJLE1BQU0sMkJBQTJCLEdBQUcsS0FBSyxJQUFtQixFQUFFO0lBQ2pFLElBQUk7UUFDQSx5Q0FBeUM7UUFDekMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFXLENBQUM7UUFFdkM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7V0FtQkc7UUFDSCxNQUFNLGNBQWMsR0FBRyxJQUFJLGdDQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFekUsNEVBQTRFO1FBQzVFLE1BQU0scUJBQXFCLEdBQWlDLE1BQU0sY0FBYyxDQUFDLHdCQUF3QixFQUFFLENBQUM7UUFFNUcsNkVBQTZFO1FBQzdFLElBQUkscUJBQXFCLEtBQUssSUFBSSxJQUFJLHFCQUFxQixLQUFLLFNBQVMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFlBQVk7WUFDNUcsQ0FBQyxxQkFBcUIsQ0FBQyxTQUFTLElBQUkscUJBQXFCLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLEtBQUssU0FBUztZQUNuSCxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN6QyxtREFBbUQ7WUFDbkQsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7WUFDNUIsS0FBSyxNQUFNLFFBQVEsSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLEVBQUU7Z0JBQy9DLElBQUksUUFBUyxDQUFDLDBCQUEwQixJQUFJLDRDQUEwQixDQUFDLE1BQU0sRUFBRTtvQkFDM0Usb0RBQW9EO29CQUNw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QkFDVjtnQ0FDSSxPQUFPLENBQUMsR0FBRyxDQUFDLG9FQUFvRSxRQUFTLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO3lCQUM3SDt3QkFDRCxtQkFBbUIsSUFBSSxDQUFDLENBQUM7cUJBQzVCO2lCQUNKO2FBQ0o7WUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLG9JQUFvSSxDQUFDLENBQUM7WUFDbEosT0FBTyxDQUFDLEdBQUcsQ0FBQyw2Q0FBNkMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLGVBQWUsbUJBQW1CLG1CQUFtQixDQUFDLENBQUM7U0FDcko7YUFBTTtZQUNIOzs7ZUFHRztZQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0ZBQWdGLENBQUMsQ0FBQztTQUNqRztLQUNKO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDWjs7O1dBR0c7UUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLDBFQUEwRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0tBQ2xHO0FBQ0wsQ0FBQyxDQUFBO0FBcFFZLFFBQUEsMkJBQTJCLCtCQW9RdkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEluZWxpZ2libGVMaW5rZWRVc2Vyc1Jlc3BvbnNlLFxuICAgIE1vb25iZWFtQ2xpZW50LFxuICAgIE5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UsXG4gICAgTm90aWZpY2F0aW9uUmVtaW5kZXJTdGF0dXMsXG4gICAgTm90aWZpY2F0aW9uUmVtaW5kZXJUeXBlLFxuICAgIE5vdGlmaWNhdGlvblR5cGUsXG4gICAgVXNlckRldGFpbHNGb3JOb3RpZmljYXRpb25zLCBVc2VyRm9yTm90aWZpY2F0aW9uUmVtaW5kZXJSZXNwb25zZVxufSBmcm9tIFwiQG1vb25iZWFtL21vb25iZWFtLW1vZGVsc1wiO1xuaW1wb3J0IHtQdWJsaXNoQ29tbWFuZCwgU05TQ2xpZW50fSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LXNuc1wiO1xuXG4vKipcbiAqIEZ1bmN0aW9uIHVzZWQgdG8gaGFuZGxlIHRoZSBkYWlseSBub3RpZmljYXRpb24gcmVtaW5kZXIgdHJpZ2dlciwgYnkgZmlyc3RcbiAqIGRldGVybWluaW5nIHdoZXRoZXIgYSBub3RpZmljYXRpb24gcmVtaW5kZXIgbmVlZHMgdG8gYmUgc2VudCBvdXQsIGFuZCBieVxuICoga2ljay1zdGFydGluZyB0aGF0IHByb2Nlc3MgZm9yIGFueSBhcHBsaWNhYmxlIHVzZXJzLCBhY2NvcmRpbmdseS5cbiAqL1xuZXhwb3J0IGNvbnN0IHRyaWdnZXJOb3RpZmljYXRpb25SZW1pbmRlciA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgICAvLyByZXRyaWV2aW5nIHRoZSBjdXJyZW50IGZ1bmN0aW9uIHJlZ2lvblxuICAgICAgICBjb25zdCByZWdpb24gPSBwcm9jZXNzLmVudi5BV1NfUkVHSU9OITtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG92ZXJhbGwgbm90aWZpY2F0aW9uIHJlbWluZGVyIGNyb24gdHJpZ2dlcmluZywgd2lsbCBiZSBtYWRlIHVwIG9mIHRoZSBmb2xsb3dpbmcgc3RlcHM6XG4gICAgICAgICAqXG4gICAgICAgICAqIDEpIENhbGwgdGhlIGdldE5vdGlmaWNhdGlvblJlbWluZGVycyBBcHBTeW5jIFF1ZXJ5IEFQSSBpbiBvcmRlciB0bzpcbiAgICAgICAgICogICAgLSBnZXQgYW55IEFDVElWRSBSRU1JTkRFUlNcbiAgICAgICAgICogICAgLSBmb3IgYW55IEFDVElWRSByZW1pbmRlcnMsIHNvcnQgdGhyb3VnaCB0aGUgb25lcyB0aGF0IG5lZWQgdG8gZ2V0IHRyaWdnZXJlZFxuICAgICAgICAgKlxuICAgICAgICAgKiAyKSBGb3IgdGhlIHJlbWluZGVycyB0aGF0IGFyZSBvZjpcbiAgICAgICAgICogICAgLSBDQVJEX0xJTktJTkdfUkVNSU5ERVIgdHlwZSwgY2FsbCB0aGUgZ2V0VXNlcnNXaXRoTm9DYXJkc1xuICAgICAgICAgKiAgICBBcHBTeW5jIFF1ZXJ5IEFQSSwgaW4gb3JkZXIgdG8gZ2V0IGFsbCB1c2VycyB0byBzZW5kIG5vdGlmaWNhdGlvbiByZW1pbmRlcnMgdG8uXG4gICAgICAgICAqXG4gICAgICAgICAqICAgIC0gTkVXX01BUF9GRUFUVVJFX1JFTUlOREVSIHR5cGUsIGNhbGwgdGhlIGdldEFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXJzIEFwcFN5bmMgUXVlcnlcbiAgICAgICAgICogICAgQVBJLCBpbiBvcmRlciB0byBnZXQgYWxsIHRoZSB1c2VycyB0byBzZW5kIG5vdGlmaWNhdGlvbiByZW1pbmRlcnMgdG8uXG4gICAgICAgICAqXG4gICAgICAgICAqIDMpIEZvciBlYWNoIGFwcGxpY2FibGUgdXNlciBmcm9tIHN0ZXAgMikgZHJvcCBhIG1lc3NhZ2UgaW50byB0aGUgYXBwcm9wcmlhdGUgU05TIHRvcGljLlxuICAgICAgICAgKlxuICAgICAgICAgKiA0KSBPbmNlIGFsbCB1c2VycyBoYXZlIGJlZW4gbm90aWZpZWQsIHRoZW4gdXBkYXRlIHRoZSBjYXJkIGxpbmtpbmcgcmVtaW5kZXIgYWNjb3JkaW5nbHksXG4gICAgICAgICAqIGJ5IGNhbGxpbmcgdGhlIHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyIEFwcFN5bmMgTXV0YXRpb24gQVBJLlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgbW9vbmJlYW1DbGllbnQgPSBuZXcgTW9vbmJlYW1DbGllbnQocHJvY2Vzcy5lbnYuRU5WX05BTUUhLCByZWdpb24pO1xuXG4gICAgICAgIC8vIDEpIENhbGwgdGhlIGdldE5vdGlmaWNhdGlvblJlbWluZGVycyBNb29uYmVhbSBBcHBTeW5jIFF1ZXJ5IEFQSSBlbmRwb2ludC5cbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uUmVtaW5kZXJzOiBOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlID0gYXdhaXQgbW9vbmJlYW1DbGllbnQuZ2V0Tm90aWZpY2F0aW9uUmVtaW5kZXJzKCk7XG5cbiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBnZXQgbm90aWZpY2F0aW9uIHJlbWluZGVycyBjYWxsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdC5cbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvblJlbWluZGVycyAhPT0gbnVsbCAmJiBub3RpZmljYXRpb25SZW1pbmRlcnMgIT09IHVuZGVmaW5lZCAmJiAhbm90aWZpY2F0aW9uUmVtaW5kZXJzLmVycm9yTWVzc2FnZSAmJlxuICAgICAgICAgICAgIW5vdGlmaWNhdGlvblJlbWluZGVycy5lcnJvclR5cGUgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJzLmRhdGEgIT09IG51bGwgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJzLmRhdGEgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgbm90aWZpY2F0aW9uUmVtaW5kZXJzLmRhdGEubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAvLyBmaWx0ZXIgdGhyb3VnaCBlYWNoIEFDVElWRSBub3RpZmljYXRpb24gcmVtaW5kZXJcbiAgICAgICAgICAgIGxldCBhY3RpdmVSZW1pbmRlckNvdW50ID0gMDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcmVtaW5kZXIgb2Ygbm90aWZpY2F0aW9uUmVtaW5kZXJzLmRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVtaW5kZXIhLm5vdGlmaWNhdGlvblJlbWluZGVyU3RhdHVzID09IE5vdGlmaWNhdGlvblJlbWluZGVyU3RhdHVzLkFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyAgc29ydCB0aHJvdWdoIHRoZSBvbmVzIHRoYXQgbmVlZCB0byBnZXQgdHJpZ2dlcmVkXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRUcmlnZ2VyRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKERhdGUucGFyc2UocmVtaW5kZXIhLm5leHRUcmlnZ2VyQXQpKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERhdGU6IERhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRUcmlnZ2VyRGF0ZS5nZXREYXRlKCkgPT09IGN1cnJlbnREYXRlLmdldERhdGUoKSAmJiBuZXh0VHJpZ2dlckRhdGUuZ2V0TW9udGgoKSA9PT0gY3VycmVudERhdGUuZ2V0TW9udGgoKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFRyaWdnZXJEYXRlLmdldEZ1bGxZZWFyKCkgPT09IGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlcGVuZGluZyBvbiB0aGUgdHlwZSBvZiBub3RpZmljYXRpb25zIHRoYXQgd2UncmUgc2VuZGluZywgYWN0IGFjY29yZGluZ2x5XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlbWluZGVyIS5ub3RpZmljYXRpb25SZW1pbmRlclR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE5vdGlmaWNhdGlvblJlbWluZGVyVHlwZS5DYXJkTGlua2luZ1JlbWluZGVyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX2ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgbmV3IEFDVElWRSBub3RpZmljYXRpb24gcmVtaW5kZXIgJHtyZW1pbmRlciEuaWR9IG9mIHR5cGUgJHtOb3RpZmljYXRpb25SZW1pbmRlclR5cGUuQ2FyZExpbmtpbmdSZW1pbmRlcn1gKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAyKSBGb3IgYW55IEFDVElWRSByZW1pbmRlcnMgb2YgdHlwZSBDQVJEX0xJTktJTkdfUkVNSU5ERVIsIGNhbGwgdGhlIGdldFVzZXJzV2l0aE5vQ2FyZHMgTW9vbmJlYW0gQXBwU3luYyBRdWVyeSBBUEkgZW5kcG9pbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJzV2l0aE5vQ2FyZHM6IEluZWxpZ2libGVMaW5rZWRVc2Vyc1Jlc3BvbnNlID0gYXdhaXQgbW9vbmJlYW1DbGllbnQuZ2V0VXNlcnNXaXRoTm9DYXJkcygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBnZXQgdXNlcnMgd2l0aCBubyBjYXJkIGNhbGwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlcnNXaXRoTm9DYXJkcyAhPT0gbnVsbCAmJiB1c2Vyc1dpdGhOb0NhcmRzICE9PSB1bmRlZmluZWQgJiYgIXVzZXJzV2l0aE5vQ2FyZHMuZXJyb3JNZXNzYWdlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhdXNlcnNXaXRoTm9DYXJkcy5lcnJvclR5cGUgJiYgdXNlcnNXaXRoTm9DYXJkcy5kYXRhICE9PSBudWxsICYmIHVzZXJzV2l0aE5vQ2FyZHMuZGF0YSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc1dpdGhOb0NhcmRzLmRhdGEubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAzKSBGb3IgZWFjaCBhcHBsaWNhYmxlIHVzZXIgZnJvbSBzdGVwIDIpIGRyb3AgYSBtZXNzYWdlIGludG8gdGhlIGFwcHJvcHJpYXRlIFNOUyB0b3BpYy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdWNjZXNzZnVsVXNlck1lc3NhZ2VzU2VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluZWxpZ2libGVVc2VyIG9mIHVzZXJzV2l0aE5vQ2FyZHMuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemluZyB0aGUgU05TIENsaWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNuc0NsaWVudCA9IG5ldyBTTlNDbGllbnQoe3JlZ2lvbjogcmVnaW9ufSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkcm9wIHRoZSBpbmVsaWdpYmxlIHVzZXIgaW5wdXQgYXMgYSBtZXNzYWdlIHRvIHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgcHJvY2Vzc2luZyB0b3BpY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJEZXRhaWxzRm9yTm90aWZpY2F0aW9uczogVXNlckRldGFpbHNGb3JOb3RpZmljYXRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaW5lbGlnaWJsZVVzZXIhLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogaW5lbGlnaWJsZVVzZXIhLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IGluZWxpZ2libGVVc2VyIS5maXJzdE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiBpbmVsaWdpYmxlVXNlciEubGFzdE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxUeXBlOiByZW1pbmRlciEubm90aWZpY2F0aW9uQ2hhbm5lbFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQ2FyZExpbmtpbmdSZW1pbmRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub3RpZmljYXRpb25SZW1pbmRlclJlY2VpcHQgPSBhd2FpdCBzbnNDbGllbnQuc2VuZChuZXcgUHVibGlzaENvbW1hbmQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb3BpY0FybjogcHJvY2Vzcy5lbnYuTk9USUZJQ0FUSU9OX1JFTUlOREVSX1BST0NFU1NJTkdfVE9QSUNfQVJOISxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZTogSlNPTi5zdHJpbmdpZnkodXNlckRldGFpbHNGb3JOb3RpZmljYXRpb25zKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHRoZSBtZXNzYWdlIGdyb3VwIGlkLCB3aWxsIGJlIHJlcHJlc2VudGVkIGJ5IHRoZSBNb29uYmVhbSBpbnRlcm5hbCB1c2VyIGlkLCBzbyB0aGF0IHdlIGNhbiBncm91cCB0aGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIHVwZGF0ZSBtZXNzYWdlcyBmb3IgYSBwYXJ0aWN1bGFyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHVzZXIgaWQsIGFuZCBzb3J0IHRoZW0gaW4gdGhlIEZJRk8gcHJvY2Vzc2luZyB0b3BpYyBhY2NvcmRpbmdseS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VHcm91cElkOiBpbmVsaWdpYmxlVXNlciEuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIG1lc3NhZ2Ugd2FzIHByb3Blcmx5IHNlbnQgdG8gdGhlIGFwcHJvcHJpYXRlIHByb2Nlc3NpbmcgdG9waWNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0ICE9PSBudWxsICYmIG5vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdCAhPT0gdW5kZWZpbmVkICYmIG5vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdC5NZXNzYWdlSWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0Lk1lc3NhZ2VJZC5sZW5ndGggIT09IDAgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0LlNlcXVlbmNlTnVtYmVyICYmIG5vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdC5TZXF1ZW5jZU51bWJlci5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG5vdGlmaWNhdGlvbiByZW1pbmRlciBtZXNzYWdlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBkcm9wcGVkIGludG8gdGhlIHRvcGljLCBhbmQgd2lsbCBiZSBwaWNrZWQgdXAgYnkgdGhlIG5vdGlmaWNhdGlvbiByZW1pbmRlciBjb25zdW1lclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm90aWZpY2F0aW9uIHJlbWluZGVyIHN1Y2Nlc3NmdWxseSBzZW50IHRvIHRvcGljIGZvciBwcm9jZXNzaW5nIHdpdGggcmVjZWlwdCBpbmZvcm1hdGlvbjogJHtub3RpZmljYXRpb25SZW1pbmRlclJlY2VpcHQuTWVzc2FnZUlkfSAke25vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdC5TZXF1ZW5jZU51bWJlcn1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIG51bWJlciBvZiBtZXNzYWdlcyBzZW50IHRvIHRoZSB0b3BpY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsVXNlck1lc3NhZ2VzU2VudCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBubyBuZWVkIGZvciBmdXJ0aGVyIGFjdGlvbnMsIHNpbmNlIHRoaXMgZXJyb3Igd2lsbCBiZSBsb2dnZWQgYW5kIG5vdGhpbmcgd2lsbCBleGVjdXRlIGZ1cnRoZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGluIHRoZSBmdXR1cmUgd2UgbWlnaHQgbmVlZCBzb21lIGFsZXJ0cyBhbmQgbWV0cmljcyBlbWl0dGluZyBoZXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5leHBlY3RlZCBlcnJvciB3aGlsZSBzZW5kaW5nIHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgZm9yIHVzZXIgJHtpbmVsaWdpYmxlVXNlciEuaWR9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgYWxsIGFwcGxpY2FibGUgdXNlcnMgaGF2ZSBoYWQgc3VjY2Vzc2Z1bCBtZXNzYWdlcyBkcm9wcGVkIGluIHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgdG9waWNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzZnVsVXNlck1lc3NhZ2VzU2VudCA9PT0gdXNlcnNXaXRoTm9DYXJkcy5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vdGlmaWNhdGlvbiByZW1pbmRlciBzdWNjZXNzZnVsbHkgc2VudCBmb3IgdXNlcnM6XFxuJHtKU09OLnN0cmluZ2lmeSh1c2Vyc1dpdGhOb0NhcmRzLmRhdGEpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIDQpIE9uY2UgYWxsIHVzZXJzIGhhdmUgYmVlbiBub3RpZmllZCwgdGhlbiB1cGRhdGUgdGhlIGNhcmQgbGlua2luZyByZW1pbmRlciBhY2NvcmRpbmdseSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBieSBjYWxsaW5nIHRoZSB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlciBBcHBTeW5jIE11dGF0aW9uIEFQSS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlOiBOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlID0gYXdhaXQgbW9vbmJlYW1DbGllbnQudXBkYXRlTm90aWZpY2F0aW9uUmVtaW5kZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogcmVtaW5kZXIhLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25SZW1pbmRlclN0YXR1czogTm90aWZpY2F0aW9uUmVtaW5kZXJTdGF0dXMuQWN0aXZlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdXBkYXRlIG5vdGlmaWNhdGlvbiByZW1pbmRlciBjYWxsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBkYXRlTm90aWZpY2F0aW9uUmVtaW5kZXJSZXNwb25zZSAhPT0gbnVsbCAmJiB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UuZXJyb3JNZXNzYWdlICYmICF1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlLmVycm9yVHlwZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlLmRhdGEgIT09IHVuZGVmaW5lZCAmJiB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlLmRhdGEgIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTm90aWZpY2F0aW9uUmVtaW5kZXJSZXNwb25zZS5kYXRhLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm90aWZpY2F0aW9uIHJlbWluZGVyICR7cmVtaW5kZXIhLmlkfSBzdWNjZXNzZnVsbHkgdXBkYXRlZGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBubyBuZWVkIGZvciBmdXJ0aGVyIGFjdGlvbnMsIHNpbmNlIHRoaXMgZXJyb3Igd2lsbCBiZSBsb2dnZWQgYW5kIG5vdGhpbmcgd2lsbCBleGVjdXRlIGZ1cnRoZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGluIHRoZSBmdXR1cmUgd2UgbWlnaHQgbmVlZCBzb21lIGFsZXJ0cyBhbmQgbWV0cmljcyBlbWl0dGluZyBoZXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVXBkYXRlIG5vdGlmaWNhdGlvbiByZW1pbmRlciB0aHJvdWdoIFVQREFURSBub3RpZmljYXRpb24gcmVtaW5kZXIgY2FsbCBmYWlsZWRgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG5vIG5lZWQgZm9yIGZ1cnRoZXIgYWN0aW9ucywgc2luY2UgdGhpcyBlcnJvciB3aWxsIGJlIGxvZ2dlZCBhbmQgbm90aGluZyB3aWxsIGV4ZWN1dGUgZnVydGhlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBpbiB0aGUgZnV0dXJlIHdlIG1pZ2h0IG5lZWQgc29tZSBhbGVydHMgYW5kIG1ldHJpY3MgZW1pdHRpbmcgaGVyZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb3QgYWxsIGFwcGxpY2FibGUgdXNlcnMgaGF2ZSBoYWQgbm90aWZpY2F0aW9uIGV2ZW50cyBkcm9wcGVkIGluIHRoZSBhcHByb3ByaWF0ZSB0b3BpYy4gUmUtcHJvY2VzcyB0aGVzZSBmYWlsZWQgbWVzc2FnZXMgYWNjb3JkaW5nbHkuYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG5vIG5lZWQgZm9yIGZ1cnRoZXIgYWN0aW9ucywgc2luY2UgdGhpcyBlcnJvciB3aWxsIGJlIGxvZ2dlZCBhbmQgbm90aGluZyB3aWxsIGV4ZWN1dGUgZnVydGhlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGluIHRoZSBmdXR1cmUgd2UgbWlnaHQgbmVlZCBzb21lIGFsZXJ0cyBhbmQgbWV0cmljcyBlbWl0dGluZyBoZXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVc2VycyB3aXRoIG5vIGNhcmRzIHJldHJpZXZhbCB0aHJvdWdoIEdFVCB1c2VycyB3aXRoIG5vIGNhcmRzIGNhbGwgZmFpbGVkYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBOb3RpZmljYXRpb25SZW1pbmRlclR5cGUuTmV3TWFwRmVhdHVyZVJlbWluZGVyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX2ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgbmV3IEFDVElWRSBub3RpZmljYXRpb24gcmVtaW5kZXIgJHtyZW1pbmRlciEuaWR9IG9mIHR5cGUgJHtOb3RpZmljYXRpb25SZW1pbmRlclR5cGUuTmV3TWFwRmVhdHVyZVJlbWluZGVyfWApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIpIEZvciBhbnkgQUNUSVZFIHJlbWluZGVycyBvZiB0eXBlIE5FV19NQVBfRkVBVFVSRV9SRU1JTkRFUiwgY2FsbCB0aGUgZ2V0QWxsVXNlcnNGb3JOb3RpZmljYXRpb25SZW1pbmRlcnMgTW9vbmJlYW0gQXBwU3luYyBRdWVyeSBBUEkgZW5kcG9pbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXI6IFVzZXJGb3JOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlID0gYXdhaXQgbW9vbmJlYW1DbGllbnQuZ2V0QWxsVXNlcnNGb3JOb3RpZmljYXRpb25SZW1pbmRlcnMoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgZ2V0IGFsbCB1c2VycyBmb3Igbm90aWZpY2F0aW9uIHJlbWluZGVycyBjYWxsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXIgIT09IG51bGwgJiYgYWxsVXNlcnNGb3JOb3RpZmljYXRpb25SZW1pbmRlciAhPT0gdW5kZWZpbmVkICYmICFhbGxVc2Vyc0Zvck5vdGlmaWNhdGlvblJlbWluZGVyLmVycm9yTWVzc2FnZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXIuZXJyb3JUeXBlICYmIGFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXIuZGF0YSAhPT0gbnVsbCAmJiBhbGxVc2Vyc0Zvck5vdGlmaWNhdGlvblJlbWluZGVyLmRhdGEgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsVXNlcnNGb3JOb3RpZmljYXRpb25SZW1pbmRlci5kYXRhLmxlbmd0aCAhPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAzKSBGb3IgZWFjaCBhcHBsaWNhYmxlIHVzZXIgZnJvbSBzdGVwIDIpIGRyb3AgYSBtZXNzYWdlIGludG8gdGhlIGFwcHJvcHJpYXRlIFNOUyB0b3BpYy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdWNjZXNzZnVsVXNlck1lc3NhZ2VzU2VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHVzZXIgb2YgYWxsVXNlcnNGb3JOb3RpZmljYXRpb25SZW1pbmRlci5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVG9EbzogUmVtb3ZlIHRoaXMgYWZ0ZXIgR29vZ2xlIEFwcHJvdmVzIHVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIhLmVtYWlsID09PSAnbWFyaXVzQG1vb25iZWFtLnZldCcgfHwgdXNlciEuZW1haWwgPT09ICdqb2hubHVrZUBtb29uYmVhbS52ZXQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemluZyB0aGUgU05TIENsaWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzbnNDbGllbnQgPSBuZXcgU05TQ2xpZW50KHtyZWdpb246IHJlZ2lvbn0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBkcm9wIHRoZSBpbmVsaWdpYmxlIHVzZXIgaW5wdXQgYXMgYSBtZXNzYWdlIHRvIHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgcHJvY2Vzc2luZyB0b3BpY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlckRldGFpbHNGb3JOb3RpZmljYXRpb25zOiBVc2VyRGV0YWlsc0Zvck5vdGlmaWNhdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdXNlciEuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdXNlciEuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHVzZXIhLmZpcnN0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB1c2VyIS5sYXN0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxUeXBlOiByZW1pbmRlciEubm90aWZpY2F0aW9uQ2hhbm5lbFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25UeXBlOiBOb3RpZmljYXRpb25UeXBlLk5ld01hcEZlYXR1cmVSZW1pbmRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdCA9IGF3YWl0IHNuc0NsaWVudC5zZW5kKG5ldyBQdWJsaXNoQ29tbWFuZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb3BpY0FybjogcHJvY2Vzcy5lbnYuTk9USUZJQ0FUSU9OX1JFTUlOREVSX1BST0NFU1NJTkdfVE9QSUNfQVJOISxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KHVzZXJEZXRhaWxzRm9yTm90aWZpY2F0aW9ucyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHRoZSBtZXNzYWdlIGdyb3VwIGlkLCB3aWxsIGJlIHJlcHJlc2VudGVkIGJ5IHRoZSBNb29uYmVhbSBpbnRlcm5hbCB1c2VyIGlkLCBzbyB0aGF0IHdlIGNhbiBncm91cCB0aGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIHVwZGF0ZSBtZXNzYWdlcyBmb3IgYSBwYXJ0aWN1bGFyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB1c2VyIGlkLCBhbmQgc29ydCB0aGVtIGluIHRoZSBGSUZPIHByb2Nlc3NpbmcgdG9waWMgYWNjb3JkaW5nbHkuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VHcm91cElkOiB1c2VyIS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIG5vdGlmaWNhdGlvbiByZW1pbmRlciBtZXNzYWdlIHdhcyBwcm9wZXJseSBzZW50IHRvIHRoZSBhcHByb3ByaWF0ZSBwcm9jZXNzaW5nIHRvcGljXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb25SZW1pbmRlclJlY2VpcHQgIT09IG51bGwgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0ICE9PSB1bmRlZmluZWQgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0Lk1lc3NhZ2VJZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0Lk1lc3NhZ2VJZC5sZW5ndGggIT09IDAgJiYgbm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0LlNlcXVlbmNlTnVtYmVyICYmIG5vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdC5TZXF1ZW5jZU51bWJlci5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgbWVzc2FnZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZHJvcHBlZCBpbnRvIHRoZSB0b3BpYywgYW5kIHdpbGwgYmUgcGlja2VkIHVwIGJ5IHRoZSBub3RpZmljYXRpb24gcmVtaW5kZXIgY29uc3VtZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb3RpZmljYXRpb24gcmVtaW5kZXIgc3VjY2Vzc2Z1bGx5IHNlbnQgdG8gdG9waWMgZm9yIHByb2Nlc3Npbmcgd2l0aCByZWNlaXB0IGluZm9ybWF0aW9uOiAke25vdGlmaWNhdGlvblJlbWluZGVyUmVjZWlwdC5NZXNzYWdlSWR9ICR7bm90aWZpY2F0aW9uUmVtaW5kZXJSZWNlaXB0LlNlcXVlbmNlTnVtYmVyfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIG51bWJlciBvZiBtZXNzYWdlcyBzZW50IHRvIHRoZSB0b3BpY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bFVzZXJNZXNzYWdlc1NlbnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbm8gbmVlZCBmb3IgZnVydGhlciBhY3Rpb25zLCBzaW5jZSB0aGlzIGVycm9yIHdpbGwgYmUgbG9nZ2VkIGFuZCBub3RoaW5nIHdpbGwgZXhlY3V0ZSBmdXJ0aGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogaW4gdGhlIGZ1dHVyZSB3ZSBtaWdodCBuZWVkIHNvbWUgYWxlcnRzIGFuZCBtZXRyaWNzIGVtaXR0aW5nIGhlcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFVuZXhwZWN0ZWQgZXJyb3Igd2hpbGUgc2VuZGluZyB0aGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIGZvciB1c2VyICR7dXNlciEuaWR9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBhbGwgYXBwbGljYWJsZSB1c2VycyBoYXZlIGhhZCBzdWNjZXNzZnVsIG1lc3NhZ2VzIGRyb3BwZWQgaW4gdGhlIG5vdGlmaWNhdGlvbiByZW1pbmRlciB0b3BpY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3NmdWxVc2VyTWVzc2FnZXNTZW50ID09PSBhbGxVc2Vyc0Zvck5vdGlmaWNhdGlvblJlbWluZGVyLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgTm90aWZpY2F0aW9uIHJlbWluZGVyIHN1Y2Nlc3NmdWxseSBzZW50IGZvciB1c2VyczpcXG4ke0pTT04uc3RyaW5naWZ5KGFsbFVzZXJzRm9yTm90aWZpY2F0aW9uUmVtaW5kZXIuZGF0YSl9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogNCkgT25jZSBhbGwgdXNlcnMgaGF2ZSBiZWVuIG5vdGlmaWVkLCB0aGVuIHVwZGF0ZSB0aGUgY2FyZCBsaW5raW5nIHJlbWluZGVyIGFjY29yZGluZ2x5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGJ5IGNhbGxpbmcgdGhlIHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyIEFwcFN5bmMgTXV0YXRpb24gQVBJLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2U6IE5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UgPSBhd2FpdCBtb29uYmVhbUNsaWVudC51cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiByZW1pbmRlciEuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblJlbWluZGVyU3RhdHVzOiBOb3RpZmljYXRpb25SZW1pbmRlclN0YXR1cy5BY3RpdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB1cGRhdGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIGNhbGwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlICE9PSBudWxsICYmIHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhdXBkYXRlTm90aWZpY2F0aW9uUmVtaW5kZXJSZXNwb25zZS5lcnJvck1lc3NhZ2UgJiYgIXVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UuZXJyb3JUeXBlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UuZGF0YSAhPT0gdW5kZWZpbmVkICYmIHVwZGF0ZU5vdGlmaWNhdGlvblJlbWluZGVyUmVzcG9uc2UuZGF0YSAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVOb3RpZmljYXRpb25SZW1pbmRlclJlc3BvbnNlLmRhdGEubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBOb3RpZmljYXRpb24gcmVtaW5kZXIgJHtyZW1pbmRlciEuaWR9IHN1Y2Nlc3NmdWxseSB1cGRhdGVkYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG5vIG5lZWQgZm9yIGZ1cnRoZXIgYWN0aW9ucywgc2luY2UgdGhpcyBlcnJvciB3aWxsIGJlIGxvZ2dlZCBhbmQgbm90aGluZyB3aWxsIGV4ZWN1dGUgZnVydGhlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogaW4gdGhlIGZ1dHVyZSB3ZSBtaWdodCBuZWVkIHNvbWUgYWxlcnRzIGFuZCBtZXRyaWNzIGVtaXR0aW5nIGhlcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVcGRhdGUgbm90aWZpY2F0aW9uIHJlbWluZGVyIHRocm91Z2ggVVBEQVRFIG5vdGlmaWNhdGlvbiByZW1pbmRlciBjYWxsIGZhaWxlZGApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbm8gbmVlZCBmb3IgZnVydGhlciBhY3Rpb25zLCBzaW5jZSB0aGlzIGVycm9yIHdpbGwgYmUgbG9nZ2VkIGFuZCBub3RoaW5nIHdpbGwgZXhlY3V0ZSBmdXJ0aGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGluIHRoZSBmdXR1cmUgd2UgbWlnaHQgbmVlZCBzb21lIGFsZXJ0cyBhbmQgbWV0cmljcyBlbWl0dGluZyBoZXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vdCBhbGwgYXBwbGljYWJsZSB1c2VycyBoYXZlIGhhZCBub3RpZmljYXRpb24gZXZlbnRzIGRyb3BwZWQgaW4gdGhlIGFwcHJvcHJpYXRlIHRvcGljLiBSZS1wcm9jZXNzIHRoZXNlIGZhaWxlZCBtZXNzYWdlcyBhY2NvcmRpbmdseS5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbm8gbmVlZCBmb3IgZnVydGhlciBhY3Rpb25zLCBzaW5jZSB0aGlzIGVycm9yIHdpbGwgYmUgbG9nZ2VkIGFuZCBub3RoaW5nIHdpbGwgZXhlY3V0ZSBmdXJ0aGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogaW4gdGhlIGZ1dHVyZSB3ZSBtaWdodCBuZWVkIHNvbWUgYWxlcnRzIGFuZCBtZXRyaWNzIGVtaXR0aW5nIGhlcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFVzZXJzIGZvciBub3RpZmljYXRpb24gcmVtaW5kZXJzIHJldHJpZXZhbCB0aHJvdWdoIEdFVCBhbGwgdXNlcnMgZm9yIG5vdGlmaWNhdGlvbiByZW1pbmRlcnMgY2FsbCBmYWlsZWRgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbm93biBub3RpZmljYXRpb24gcmVtaW5kZXIgdHlwZSBwYXNzZWQgaW4gZm9yIEFDVElWRSByZW1pbmRlciAke3JlbWluZGVyIS5ub3RpZmljYXRpb25SZW1pbmRlclR5cGV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVSZW1pbmRlckNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX2ApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFJhbiB0cmlnZ2VyIGZvciBOb3RpZmljYXRpb24gUmVtaW5kZXJzIGF0ICR7bmV3IERhdGUoRGF0ZS5ub3coKSkudG9JU09TdHJpbmcoKX0sIGFuZCBmb3VuZCAke2FjdGl2ZVJlbWluZGVyQ291bnR9IEFDVElWRSByZW1pbmRlcnNgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogbm8gbmVlZCBmb3IgZnVydGhlciBhY3Rpb25zLCBzaW5jZSB0aGlzIGVycm9yIHdpbGwgYmUgbG9nZ2VkIGFuZCBub3RoaW5nIHdpbGwgZXhlY3V0ZSBmdXJ0aGVyLlxuICAgICAgICAgICAgICogaW4gdGhlIGZ1dHVyZSB3ZSBtaWdodCBuZWVkIHNvbWUgYWxlcnRzIGFuZCBtZXRyaWNzIGVtaXR0aW5nIGhlcmVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc29sZS5sb2coYE5vdGlmaWNhdGlvbiBSZW1pbmRlciByZXRyaWV2YWwgdGhyb3VnaCBHRVQgbm90aWZpY2F0aW9uIHJlbWluZGVycyBjYWxsIGZhaWxlZGApO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIG5vIG5lZWQgZm9yIGZ1cnRoZXIgYWN0aW9ucywgc2luY2UgdGhpcyBlcnJvciB3aWxsIGJlIGxvZ2dlZCBhbmQgbm90aGluZyB3aWxsIGV4ZWN1dGUgZnVydGhlci5cbiAgICAgICAgICogaW4gdGhlIGZ1dHVyZSB3ZSBtaWdodCBuZWVkIHNvbWUgYWxlcnRzIGFuZCBtZXRyaWNzIGVtaXR0aW5nIGhlcmVcbiAgICAgICAgICovXG4gICAgICAgIGNvbnNvbGUubG9nKGBVbmV4cGVjdGVkIGVycm9yIHdoaWxlIHByb2Nlc3NpbmcgdGhlIG5vdGlmaWNhdGlvbiByZW1pbmRlciBjcm9uIGV2ZW50ICR7ZXJyb3J9YCk7XG4gICAgfVxufVxuIl19